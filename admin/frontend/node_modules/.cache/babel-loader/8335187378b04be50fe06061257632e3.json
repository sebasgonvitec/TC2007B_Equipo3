{"ast":null,"code":"/* eslint-disable no-multi-spaces, key-spacing, indent, camelcase, space-before-blocks, eqeqeq, brace-style */\n\n/* eslint-disable space-infix-ops, space-before-function-paren, array-bracket-spacing, object-curly-spacing */\n\n/* eslint-disable no-nested-ternary, max-params, default-case, no-else-return, no-empty */\n\n/* eslint-disable no-param-reassign, no-var, block-scoped-var */\nimport { BinaryStream, ucs2encode, base64ToUint8Array, HAS_TYPED_ARRAYS } from \"./utils\";\nimport { support } from '../common';\nimport { TTFFont } from \"./ttf\";\nimport { deflate, supportsDeflate } from './deflate';\nimport { encodeUTF16BE, BOM } from \"../util/encode-utf\";\nimport { encodeBase64 } from \"../util\";\nvar browser = support.browser;\nvar NL = \"\\n\";\nvar RESOURCE_COUNTER = 0;\nvar PAPER_SIZE = {\n  a0: [2383.94, 3370.39],\n  a1: [1683.78, 2383.94],\n  a2: [1190.55, 1683.78],\n  a3: [841.89, 1190.55],\n  a4: [595.28, 841.89],\n  a5: [419.53, 595.28],\n  a6: [297.64, 419.53],\n  a7: [209.76, 297.64],\n  a8: [147.40, 209.76],\n  a9: [104.88, 147.40],\n  a10: [73.70, 104.88],\n  b0: [2834.65, 4008.19],\n  b1: [2004.09, 2834.65],\n  b2: [1417.32, 2004.09],\n  b3: [1000.63, 1417.32],\n  b4: [708.66, 1000.63],\n  b5: [498.90, 708.66],\n  b6: [354.33, 498.90],\n  b7: [249.45, 354.33],\n  b8: [175.75, 249.45],\n  b9: [124.72, 175.75],\n  b10: [87.87, 124.72],\n  c0: [2599.37, 3676.54],\n  c1: [1836.85, 2599.37],\n  c2: [1298.27, 1836.85],\n  c3: [918.43, 1298.27],\n  c4: [649.13, 918.43],\n  c5: [459.21, 649.13],\n  c6: [323.15, 459.21],\n  c7: [229.61, 323.15],\n  c8: [161.57, 229.61],\n  c9: [113.39, 161.57],\n  c10: [79.37, 113.39],\n  executive: [521.86, 756.00],\n  folio: [612.00, 936.00],\n  legal: [612.00, 1008.00],\n  letter: [612.00, 792.00],\n  tabloid: [792.00, 1224.00]\n};\n\nfunction makeOutput() {\n  var indentLevel = 0,\n      output = BinaryStream();\n\n  function out() {\n    var arguments$1 = arguments;\n\n    for (var i = 0; i < arguments.length; ++i) {\n      var x = arguments$1[i];\n\n      if (x === undefined) {\n        throw new Error(\"Cannot output undefined to PDF\");\n      } else if (x instanceof PDFValue) {\n        x.beforeRender(out);\n        x.render(out);\n      } else if (isArray(x)) {\n        renderArray(x, out);\n      } else if (isDate(x)) {\n        renderDate(x, out);\n      } else if (typeof x == \"number\") {\n        if (isNaN(x)) {\n          throw new Error(\"Cannot output NaN to PDF\");\n        } // make sure it doesn't end up in exponent notation\n\n\n        var num = x.toFixed(7);\n\n        if (num.indexOf(\".\") >= 0) {\n          num = num.replace(/\\.?0+$/, \"\");\n        }\n\n        if (num == \"-0\") {\n          num = \"0\";\n        }\n\n        output.writeString(num);\n      } else if (/string|boolean/.test(typeof x)) {\n        output.writeString(String(x));\n      } else if (typeof x.get == \"function\") {\n        output.write(x.get());\n      } else if (typeof x == \"object\") {\n        if (!x) {\n          output.writeString(\"null\");\n        } else {\n          out(new PDFDictionary(x));\n        }\n      }\n    }\n  }\n\n  out.writeData = function (data) {\n    output.write(data);\n  };\n\n  out.withIndent = function (f) {\n    ++indentLevel;\n    f(out);\n    --indentLevel;\n  };\n\n  out.indent = function () {\n    out(NL, pad(\"\", indentLevel * 2, \"  \"));\n    out.apply(null, arguments);\n  };\n\n  out.offset = function () {\n    return output.offset();\n  };\n\n  out.toString = function () {\n    throw new Error(\"FIX CALLER\");\n  };\n\n  out.get = function () {\n    return output.get();\n  };\n\n  out.stream = function () {\n    return output;\n  };\n\n  return out;\n}\n\nfunction wrapObject(value, id) {\n  var beforeRender = value.beforeRender;\n  var renderValue = value.render;\n\n  value.beforeRender = function () {};\n\n  value.render = function (out) {\n    out(id, \" 0 R\");\n  };\n\n  value.renderFull = function (out) {\n    value._offset = out.offset();\n    out(id, \" 0 obj \");\n    beforeRender.call(value, out);\n    renderValue.call(value, out);\n    out(\" endobj\");\n  };\n}\n\nfunction getPaperOptions(getOption) {\n  if (typeof getOption != \"function\") {\n    var options = getOption;\n\n    getOption = function (key, def) {\n      return key in options ? options[key] : def;\n    };\n  }\n\n  var paperSize = getOption(\"paperSize\", PAPER_SIZE.a4);\n\n  if (!paperSize) {\n    return {};\n  }\n\n  if (typeof paperSize == \"string\") {\n    paperSize = PAPER_SIZE[paperSize.toLowerCase()];\n\n    if (paperSize == null) {\n      throw new Error(\"Unknown paper size\");\n    }\n  }\n\n  paperSize[0] = unitsToPoints(paperSize[0]);\n  paperSize[1] = unitsToPoints(paperSize[1]);\n\n  if (getOption(\"landscape\", false)) {\n    paperSize = [Math.max(paperSize[0], paperSize[1]), Math.min(paperSize[0], paperSize[1])];\n  }\n\n  var margin = getOption(\"margin\");\n\n  if (margin) {\n    if (typeof margin == \"string\" || typeof margin == \"number\") {\n      margin = unitsToPoints(margin, 0);\n      margin = {\n        left: margin,\n        top: margin,\n        right: margin,\n        bottom: margin\n      };\n    } else {\n      margin = {\n        left: unitsToPoints(margin.left, 0),\n        top: unitsToPoints(margin.top, 0),\n        right: unitsToPoints(margin.right, 0),\n        bottom: unitsToPoints(margin.bottom, 0)\n      };\n    }\n\n    if (getOption(\"addMargin\")) {\n      paperSize[0] += margin.left + margin.right;\n      paperSize[1] += margin.top + margin.bottom;\n    }\n  }\n\n  return {\n    paperSize: paperSize,\n    margin: margin\n  };\n}\n\nvar FONT_CACHE = {\n  \"Times-Roman\": true,\n  \"Times-Bold\": true,\n  \"Times-Italic\": true,\n  \"Times-BoldItalic\": true,\n  \"Helvetica\": true,\n  \"Helvetica-Bold\": true,\n  \"Helvetica-Oblique\": true,\n  \"Helvetica-BoldOblique\": true,\n  \"Courier\": true,\n  \"Courier-Bold\": true,\n  \"Courier-Oblique\": true,\n  \"Courier-BoldOblique\": true,\n  \"Symbol\": true,\n  \"ZapfDingbats\": true\n};\n\nfunction loadBinary(url, cont) {\n  // IE throws Accesss denied error for Data URIs\n  var m;\n\n  if (browser.msie && (m = /^data:.*?;base64,/i.exec(url))) {\n    cont(base64ToUint8Array(url.substr(m[0].length)));\n    return;\n  }\n\n  function error() {\n    if (window.console) {\n      if (window.console.error) {\n        window.console.error(\"Cannot load URL: %s\", url);\n      } else {\n        window.console.log(\"Cannot load URL: %s\", url);\n      }\n    }\n\n    cont(null);\n  }\n\n  var req = new XMLHttpRequest();\n  req.open('GET', url, true);\n\n  if (HAS_TYPED_ARRAYS) {\n    req.responseType = \"arraybuffer\";\n  }\n\n  req.onload = function () {\n    if (req.status == 200 || req.status == 304) {\n      if (HAS_TYPED_ARRAYS) {\n        cont(new Uint8Array(req.response));\n      } else {\n        cont(new window.VBArray(req.responseBody).toArray()); // IE9 only\n      }\n    } else {\n      error();\n    }\n  };\n\n  req.onerror = error;\n  req.send(null);\n}\n\nfunction loadFont(url, cont) {\n  var font = FONT_CACHE[url];\n\n  if (font) {\n    cont(font);\n  } else {\n    loadBinary(url, function (data) {\n      if (data == null) {\n        throw new Error(\"Cannot load font from \" + url);\n      } else {\n        var font = new TTFFont(data);\n        FONT_CACHE[url] = font;\n        cont(font);\n      }\n    });\n  }\n}\n\nvar IMAGE_CACHE = {};\n\nfunction clearImageCache() {\n  IMAGE_CACHE = {};\n}\n\nfunction loadImage(url, size, cont, options) {\n  var img = IMAGE_CACHE[url],\n      bloburl,\n      blob;\n\n  if (img) {\n    cont(img);\n  } else {\n    img = new Image();\n\n    if (!/^data:/i.test(url)) {\n      img.crossOrigin = \"Anonymous\";\n    }\n\n    if (HAS_TYPED_ARRAYS && !/^data:/i.test(url)) {\n      // IE10 fails to load images from another domain even when the server sends the\n      // proper CORS headers.  a XHR, however, will be able to load the data.\n      // http://stackoverflow.com/a/19734516/154985\n      //\n      // On the other hand, it's worth doing it this way for all browsers which support\n      // responseType = \"blob\" (HAS_TYPED_ARRAYS will be true), because we can inspect the\n      // mime type and if it's a JPEG (very common case) we can save a lot of time in\n      // _load below.\n      var xhr = new XMLHttpRequest();\n\n      xhr.onload = function () {\n        blob = xhr.response;\n\n        if (browser.mozilla && blob.type == \"image/svg+xml\") {\n          // Firefox won't render SVGs that don't contain width and height attributes.\n          var reader = new FileReader();\n\n          reader.onload = function () {\n            var doc = new window.DOMParser().parseFromString(this.result, \"image/svg+xml\");\n            var svg = doc.documentElement;\n\n            if (svg.getAttribute(\"width\") && svg.getAttribute(\"height\")) {\n              // we're good, continue with the existing blob.\n              bloburl = URL.createObjectURL(blob);\n\n              _load(bloburl);\n            } else {\n              svg.setAttribute(\"width\", size.width);\n              svg.setAttribute(\"height\", size.height);\n              var xml = new window.XMLSerializer().serializeToString(svg);\n              var dataURL = \"data:image/svg+xml;base64,\" + encodeBase64(xml);\n\n              _load(dataURL);\n            }\n          };\n\n          reader.readAsText(blob);\n        } else {\n          bloburl = URL.createObjectURL(blob);\n\n          _load(bloburl);\n        }\n      };\n\n      xhr.onerror = _onerror;\n      xhr.open(\"GET\", url, true);\n      xhr.responseType = \"blob\";\n      xhr.send();\n    } else {\n      _load(url);\n    }\n  }\n\n  function _load(url) {\n    img.src = url;\n\n    if (img.complete && !browser.msie) {\n      // IE, bless its little heart, says img.complete == true even though the image is\n      // not loaded (width=0), therefore we must go the onload route (ticket 929635).\n      _onload.call(img);\n    } else {\n      img.onload = _onload;\n      img.onerror = _onerror;\n    }\n  }\n\n  function _trycanvas() {\n    if (!size) {\n      size = {\n        width: img.width,\n        height: img.height\n      };\n    }\n\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = size.width;\n    canvas.height = size.height;\n    var ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(img, 0, 0, size.width, size.height);\n    var imgdata;\n\n    try {\n      imgdata = ctx.getImageData(0, 0, size.width, size.height);\n    } catch (ex) {\n      // it tainted the canvas -- can't draw it.\n      _onerror();\n\n      return;\n    } finally {\n      if (bloburl) {\n        URL.revokeObjectURL(bloburl);\n      }\n    } // in case it contains transparency, we must separate rgb data from the alpha\n    // channel and create a PDFRawImage image with opacity.  otherwise we can use a\n    // PDFJpegImage.\n    //\n    // to do this in one step, we create the rgb and alpha streams anyway, even if\n    // we might end up not using them if hasAlpha remains false.\n\n\n    var hasAlpha = false,\n        rgb = BinaryStream(),\n        alpha = BinaryStream();\n    var rawbytes = imgdata.data;\n    var i = 0;\n\n    while (i < rawbytes.length) {\n      rgb.writeByte(rawbytes[i++]);\n      rgb.writeByte(rawbytes[i++]);\n      rgb.writeByte(rawbytes[i++]);\n      var a = rawbytes[i++];\n\n      if (a < 255) {\n        hasAlpha = true;\n      }\n\n      alpha.writeByte(a);\n    }\n\n    if (hasAlpha || options.keepPNG) {\n      img = new PDFRawImage(size.width, size.height, rgb, alpha);\n    } else {\n      // no transparency, encode as JPEG.\n      var data = canvas.toDataURL(\"image/jpeg\", options.jpegQuality);\n      data = data.substr(data.indexOf(\";base64,\") + 8);\n      var stream = BinaryStream();\n      stream.writeBase64(data);\n      img = new PDFJpegImage(stream);\n    }\n\n    cont(IMAGE_CACHE[url] = img);\n  }\n\n  function _onerror() {\n    cont(IMAGE_CACHE[url] = \"ERROR\");\n  }\n\n  function _onload() {\n    if (size) {\n      var svg = blob && blob.type === 'image/svg+xml' || /^data:image\\/svg\\+xml;/i.test(this.src.substring(0, 19));\n      var upscale = size.width >= img.width || size.height >= img.height; // Use the original image if requested size is bigger than the source,\n      // unless it's an SVG that can be upscaled.\n\n      if (!svg && upscale) {\n        size = null;\n      }\n    }\n\n    if (!size && blob && /^image\\/jpe?g$/i.test(blob.type)) {\n      // If we know we got a JPEG, we can skip the process of rendering it to a\n      // canvas, getting the pixel data, searching for transparency we know we won't\n      // find, getting back a data URI and then decoding the BASE64 to finally get the\n      // binary we already have.  Also, we avoid downgrading the image quality, with\n      // the possible drawback of making a bigger PDF; still, seems legit.\n      //\n      // Besides saving a lot of work, this also reuses the buffer memory\n      // (BinaryStream does not create a copy), potentially saving some GC cycles.\n      var reader = new FileReader();\n\n      reader.onload = function () {\n        try {\n          var img = new PDFJpegImage(BinaryStream(new Uint8Array(this.result)));\n          URL.revokeObjectURL(bloburl);\n          cont(IMAGE_CACHE[url] = img);\n        } catch (ex) {\n          // if there's an error parsing the JPEG stream, it could be due to a\n          // misconfigured server (improper content-type:\n          // https://github.com/telerik/kendo-ui-core/issues/4184).  If that's the case,\n          // the canvas will still be able to draw it.\n          _trycanvas();\n        }\n      };\n\n      reader.readAsArrayBuffer(blob);\n    } else {\n      _trycanvas();\n    }\n  }\n}\n\nfunction manyLoader(loadOne) {\n  return function (urls, callback) {\n    var n = urls.length,\n        i = n;\n\n    if (n === 0) {\n      return callback();\n    }\n\n    function next() {\n      if (--n === 0) {\n        callback();\n      }\n    }\n\n    while (i-- > 0) {\n      loadOne(urls[i], next);\n    }\n  };\n}\n\nvar loadFonts = manyLoader(loadFont);\n\nvar loadImages = function (images, callback, options) {\n  options = Object.assign({\n    jpegQuality: 0.92,\n    keepPNG: false\n  }, options);\n  var urls = Object.keys(images),\n      n = urls.length;\n\n  if (n === 0) {\n    return callback();\n  }\n\n  function next() {\n    if (--n === 0) {\n      callback();\n    }\n  }\n\n  urls.forEach(function (url) {\n    loadImage(url, images[url], next, options);\n  });\n};\n\nvar PDFDocument = function PDFDocument(options) {\n  var self = this;\n  var out = makeOutput();\n  var objcount = 0;\n  var objects = [];\n\n  function getOption(name, defval) {\n    return options && options[name] != null ? options[name] : defval;\n  }\n\n  self.getOption = getOption;\n\n  self.attach = function (value) {\n    if (objects.indexOf(value) < 0) {\n      wrapObject(value, ++objcount);\n      objects.push(value);\n    }\n\n    return value;\n  };\n\n  self.pages = [];\n  self.FONTS = {};\n  self.IMAGES = {};\n  self.GRAD_COL_FUNCTIONS = {}; // cache for color gradient functions\n\n  self.GRAD_OPC_FUNCTIONS = {}; // cache for opacity gradient functions\n\n  self.GRAD_COL = {}; // cache for whole color gradient objects\n\n  self.GRAD_OPC = {}; // cache for whole opacity gradient objects\n\n  var catalog = self.attach(new PDFCatalog());\n  var pageTree = self.attach(new PDFPageTree());\n\n  if (getOption(\"autoPrint\")) {\n    var nameTree = {};\n    nameTree.JavaScript = new PDFDictionary({\n      Names: [new PDFString(\"JS\"), self.attach(new PDFDictionary({\n        S: _(\"JavaScript\"),\n        JS: new PDFString(\"print(true);\")\n      }))]\n    });\n    catalog.props.Names = new PDFDictionary(nameTree);\n  }\n\n  catalog.setPages(pageTree);\n  var info = self.attach(new PDFDictionary({\n    Producer: new PDFString(getOption(\"producer\", \"Kendo UI PDF Generator\"), true),\n    // XXX: kendo.version?\n    Title: new PDFString(getOption(\"title\", \"\"), true),\n    Author: new PDFString(getOption(\"author\", \"\"), true),\n    Subject: new PDFString(getOption(\"subject\", \"\"), true),\n    Keywords: new PDFString(getOption(\"keywords\", \"\"), true),\n    Creator: new PDFString(getOption(\"creator\", \"Kendo UI PDF Generator\"), true),\n    CreationDate: getOption(\"date\", new Date())\n  }));\n\n  self.addPage = function (options) {\n    var paperOptions = getPaperOptions(function (name, defval) {\n      return options && options[name] != null ? options[name] : defval;\n    });\n    var paperSize = paperOptions.paperSize;\n    var margin = paperOptions.margin;\n    var contentWidth = paperSize[0];\n    var contentHeight = paperSize[1];\n\n    if (margin) {\n      contentWidth -= margin.left + margin.right;\n      contentHeight -= margin.top + margin.bottom;\n    }\n\n    var content = new PDFStream(makeOutput(), null, true);\n    var props = {\n      Contents: self.attach(content),\n      Parent: pageTree,\n      MediaBox: [0, 0, paperSize[0], paperSize[1]]\n    };\n    var page = new PDFPage(self, props);\n    page._content = content;\n    pageTree.addPage(self.attach(page)); // canvas-like coord. system.  (0,0) is upper-left.\n    // text must be vertically mirorred before drawing.\n\n    page.transform(1, 0, 0, -1, 0, paperSize[1]);\n\n    if (margin) {\n      page.translate(margin.left, margin.top); // XXX: clip to right/bottom margin.  Make this optional?\n\n      page.rect(0, 0, contentWidth, contentHeight);\n      page.clip();\n    }\n\n    self.pages.push(page);\n    return page;\n  };\n\n  self.render = function () {\n    var i; /// file header\n\n    out(\"%PDF-1.4\", NL, \"%\\xc2\\xc1\\xda\\xcf\\xce\", NL, NL); /// file body\n\n    for (i = 0; i < objects.length; ++i) {\n      objects[i].renderFull(out);\n      out(NL, NL);\n    } /// cross-reference table\n\n\n    var xrefOffset = out.offset();\n    out(\"xref\", NL, 0, \" \", objects.length + 1, NL);\n    out(\"0000000000 65535 f \", NL);\n\n    for (i = 0; i < objects.length; ++i) {\n      out(zeropad(objects[i]._offset, 10), \" 00000 n \", NL);\n    }\n\n    out(NL); /// trailer\n\n    out(\"trailer\", NL);\n    out(new PDFDictionary({\n      Size: objects.length + 1,\n      Root: catalog,\n      Info: info\n    }), NL, NL); /// end\n\n    out(\"startxref\", NL, xrefOffset, NL);\n    out(\"%%EOF\", NL);\n    return out.stream().offset(0);\n  };\n\n  self.loadFonts = loadFonts;\n  self.loadImages = loadImages;\n};\n\nPDFDocument.prototype.getFont = function getFont(url) {\n  var font = this.FONTS[url];\n\n  if (!font) {\n    font = FONT_CACHE[url];\n\n    if (!font) {\n      throw new Error(\"Font \" + url + \" has not been loaded\");\n    }\n\n    if (font === true) {\n      font = this.attach(new PDFStandardFont(url));\n    } else {\n      font = this.attach(new PDFFont(this, font));\n    }\n\n    this.FONTS[url] = font;\n  }\n\n  return font;\n};\n\nPDFDocument.prototype.getImage = function getImage(url) {\n  var img = this.IMAGES[url];\n\n  if (!img) {\n    img = IMAGE_CACHE[url];\n\n    if (!img) {\n      throw new Error(\"Image \" + url + \" has not been loaded\");\n    }\n\n    if (img === \"ERROR\") {\n      return null;\n    }\n\n    img = this.IMAGES[url] = this.attach(img.asStream(this));\n  }\n\n  return img;\n};\n\nPDFDocument.prototype.getOpacityGS = function getOpacityGS(opacity, forStroke) {\n  var id = parseFloat(opacity).toFixed(3);\n  opacity = parseFloat(id);\n  id += forStroke ? \"S\" : \"F\";\n  var cache = this._opacityGSCache || (this._opacityGSCache = {});\n  var gs = cache[id];\n\n  if (!gs) {\n    var props = {\n      Type: _(\"ExtGState\")\n    };\n\n    if (forStroke) {\n      props.CA = opacity;\n    } else {\n      props.ca = opacity;\n    }\n\n    gs = this.attach(new PDFDictionary(props));\n    gs._resourceName = _(\"GS\" + ++RESOURCE_COUNTER);\n    cache[id] = gs;\n  }\n\n  return gs;\n};\n\nPDFDocument.prototype.dict = function dict(props) {\n  return new PDFDictionary(props);\n};\n\nPDFDocument.prototype.name = function name(str) {\n  return _(str);\n};\n\nPDFDocument.prototype.stream = function stream(props, content) {\n  return new PDFStream(content, props);\n};\n/* -----[ utils ]----- */\n\n\nfunction pad(str, len, ch) {\n  while (str.length < len) {\n    str = ch + str;\n  }\n\n  return str;\n}\n\nfunction zeropad(n, len) {\n  return pad(String(n), len, \"0\");\n}\n\nfunction hasOwnProperty(obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nvar isArray = Array.isArray || function (obj) {\n  return obj instanceof Array;\n};\n\nfunction isDate(obj) {\n  return obj instanceof Date;\n}\n\nfunction renderArray(a, out) {\n  out(\"[\");\n\n  if (a.length > 0) {\n    out.withIndent(function () {\n      for (var i = 0; i < a.length; ++i) {\n        if (i > 0 && i % 8 === 0) {\n          out.indent(a[i]);\n        } else {\n          out(\" \", a[i]);\n        }\n      }\n    }); //out.indent();\n  }\n\n  out(\" ]\");\n}\n\nfunction renderDate(date, out) {\n  out(\"(D:\", zeropad(date.getUTCFullYear(), 4), zeropad(date.getUTCMonth() + 1, 2), zeropad(date.getUTCDate(), 2), zeropad(date.getUTCHours(), 2), zeropad(date.getUTCMinutes(), 2), zeropad(date.getUTCSeconds(), 2), \"Z)\");\n}\n\nfunction mm2pt(mm) {\n  return mm * (72 / 25.4);\n}\n\nfunction cm2pt(cm) {\n  return mm2pt(cm * 10);\n}\n\nfunction in2pt(inch) {\n  return inch * 72;\n}\n\nfunction unitsToPoints(x, def) {\n  if (typeof x == \"number\") {\n    return x;\n  }\n\n  if (typeof x == \"string\") {\n    var m;\n    m = /^\\s*([0-9.]+)\\s*(mm|cm|in|pt)\\s*$/.exec(x);\n\n    if (m) {\n      var num = parseFloat(m[1]);\n\n      if (!isNaN(num)) {\n        if (m[2] == \"pt\") {\n          return num;\n        }\n\n        return {\n          \"mm\": mm2pt,\n          \"cm\": cm2pt,\n          \"in\": in2pt\n        }[m[2]](num);\n      }\n    }\n  }\n\n  if (def != null) {\n    return def;\n  }\n\n  throw new Error(\"Can't parse unit: \" + x);\n}\n/* -----[ PDF basic objects ]----- */\n\n\nvar PDFValue = function PDFValue() {};\n\nPDFValue.prototype.beforeRender = function beforeRender() {};\n\nvar PDFString = function (PDFValue) {\n  function PDFString(value, utf16be) {\n    PDFValue.call(this);\n    this.value = value;\n    this.utf16be = Boolean(utf16be);\n  }\n\n  if (PDFValue) PDFString.__proto__ = PDFValue;\n  PDFString.prototype = Object.create(PDFValue && PDFValue.prototype);\n  PDFString.prototype.constructor = PDFString;\n\n  PDFString.prototype.render = function render(out) {\n    var txt = this.value;\n\n    if (this.utf16be) {\n      txt = BOM + encodeUTF16BE(txt);\n      txt = txt.replace(/([\\(\\)\\\\])/g, \"\\\\$1\");\n      out(\"(\", txt, \")\");\n    } else {\n      // out.writeString truncates charcodes to 8 bits and\n      // 0x128 & 0xFF is 40, the code for open paren.\n      // therefore we need to do the chopping here to make\n      // sure we backslash all cases.\n      var data = [40]; // open PDF string '('\n\n      for (var i = 0; i < txt.length; ++i) {\n        var code = txt.charCodeAt(i) & 0xFF;\n\n        if (code == 40 || code == 41 || code == 92) {\n          // backslash before (, ) and \\\n          data.push(92);\n        }\n\n        data.push(code);\n      }\n\n      data.push(41); // ')' close PDF string\n\n      out.writeData(data);\n    }\n  };\n\n  PDFString.prototype.toString = function toString() {\n    return this.value;\n  };\n\n  return PDFString;\n}(PDFValue);\n\nvar PDFHexString = function (PDFString) {\n  function PDFHexString(value) {\n    PDFString.call(this, value);\n    this.value = value;\n  }\n\n  if (PDFString) PDFHexString.__proto__ = PDFString;\n  PDFHexString.prototype = Object.create(PDFString && PDFString.prototype);\n  PDFHexString.prototype.constructor = PDFHexString;\n\n  PDFHexString.prototype.render = function render(out) {\n    var this$1 = this;\n    out(\"<\");\n\n    for (var i = 0; i < this.value.length; ++i) {\n      out(zeropad(this$1.value.charCodeAt(i).toString(16), 4));\n    }\n\n    out(\">\");\n  };\n\n  return PDFHexString;\n}(PDFString); /// names\n\n\nvar PDFName = function (PDFValue) {\n  function PDFName(name) {\n    PDFValue.call(this);\n    this.name = name;\n  }\n\n  if (PDFValue) PDFName.__proto__ = PDFValue;\n  PDFName.prototype = Object.create(PDFValue && PDFValue.prototype);\n  PDFName.prototype.constructor = PDFName;\n\n  PDFName.get = function get(name) {\n    return _(name);\n  };\n\n  PDFName.prototype.render = function render(out) {\n    out(\"/\" + this.escape());\n  };\n\n  PDFName.prototype.escape = function escape() {\n    return this.name.replace(/[^\\x21-\\x7E]/g, function (c) {\n      return \"#\" + zeropad(c.charCodeAt(0).toString(16), 2);\n    });\n  };\n\n  PDFName.prototype.toString = function toString() {\n    return this.name;\n  };\n\n  return PDFName;\n}(PDFValue);\n\nvar PDFName_cache = {};\n\nfunction _(name) {\n  if (hasOwnProperty(PDFName_cache, name)) {\n    return PDFName_cache[name];\n  }\n\n  return PDFName_cache[name] = new PDFName(name);\n} /// dictionary\n\n\nvar PDFDictionary = function (PDFValue) {\n  function PDFDictionary(props) {\n    PDFValue.call(this);\n    this.props = props;\n  }\n\n  if (PDFValue) PDFDictionary.__proto__ = PDFValue;\n  PDFDictionary.prototype = Object.create(PDFValue && PDFValue.prototype);\n  PDFDictionary.prototype.constructor = PDFDictionary;\n\n  PDFDictionary.prototype.render = function render(out) {\n    var props = this.props,\n        empty = true;\n    out(\"<<\");\n    out.withIndent(function () {\n      for (var i in props) {\n        if (hasOwnProperty(props, i) && !/^_/.test(i)) {\n          empty = false;\n          out.indent(_(i), \" \", props[i]);\n        }\n      }\n    });\n\n    if (!empty) {\n      out.indent();\n    }\n\n    out(\">>\");\n  };\n\n  return PDFDictionary;\n}(PDFValue); /// streams\n\n\nvar PDFStream = function (PDFValue) {\n  function PDFStream(data, props, compress) {\n    PDFValue.call(this);\n\n    if (typeof data == \"string\") {\n      var tmp = BinaryStream();\n      tmp.write(data);\n      data = tmp;\n    }\n\n    this.data = data;\n    this.props = props || {};\n    this.compress = compress;\n  }\n\n  if (PDFValue) PDFStream.__proto__ = PDFValue;\n  PDFStream.prototype = Object.create(PDFValue && PDFValue.prototype);\n  PDFStream.prototype.constructor = PDFStream;\n\n  PDFStream.prototype.render = function render(out) {\n    var data = this.data.get(),\n        props = this.props;\n\n    if (this.compress && supportsDeflate()) {\n      if (!props.Filter) {\n        props.Filter = [];\n      } else if (!(props.Filter instanceof Array)) {\n        props.Filter = [props.Filter];\n      }\n\n      props.Filter.unshift(_(\"FlateDecode\"));\n      data = deflate(data);\n    }\n\n    props.Length = data.length;\n    out(new PDFDictionary(props), \" stream\", NL);\n    out.writeData(data);\n    out(NL, \"endstream\");\n  };\n\n  return PDFStream;\n}(PDFValue); /// catalog\n\n\nvar PDFCatalog = function (PDFDictionary) {\n  function PDFCatalog() {\n    PDFDictionary.call(this, {\n      Type: _(\"Catalog\")\n    });\n  }\n\n  if (PDFDictionary) PDFCatalog.__proto__ = PDFDictionary;\n  PDFCatalog.prototype = Object.create(PDFDictionary && PDFDictionary.prototype);\n  PDFCatalog.prototype.constructor = PDFCatalog;\n\n  PDFCatalog.prototype.setPages = function setPages(pagesObj) {\n    this.props.Pages = pagesObj;\n  };\n\n  return PDFCatalog;\n}(PDFDictionary); /// page tree\n\n\nvar PDFPageTree = function (PDFDictionary) {\n  function PDFPageTree() {\n    PDFDictionary.call(this, {\n      Type: _(\"Pages\"),\n      Kids: [],\n      Count: 0\n    });\n  }\n\n  if (PDFDictionary) PDFPageTree.__proto__ = PDFDictionary;\n  PDFPageTree.prototype = Object.create(PDFDictionary && PDFDictionary.prototype);\n  PDFPageTree.prototype.constructor = PDFPageTree;\n\n  PDFPageTree.prototype.addPage = function addPage(pageObj) {\n    this.props.Kids.push(pageObj);\n    this.props.Count++;\n  };\n\n  return PDFPageTree;\n}(PDFDictionary); /// images\n// JPEG\n\n\nvar SOF_CODES = [0xc0, 0xc1, 0xc2, 0xc3, 0xc5, 0xc6, 0xc7, 0xc9, 0xca, 0xcb, 0xcd, 0xce, 0xcf];\n\nvar PDFJpegImage = function PDFJpegImage(data) {\n  // we must determine the correct color space.  we'll parse a bit\n  // of the JPEG stream for this, it's still better than going\n  // through the canvas.\n  // https://github.com/telerik/kendo-ui-core/issues/2845\n  data.offset(0);\n  var width, height, colorSpace, bitsPerComponent;\n  var soi = data.readShort();\n\n  if (soi != 0xFFD8) {\n    // XXX: do we have some better options here?\n    throw new Error(\"Invalid JPEG image\");\n  }\n\n  while (!data.eof()) {\n    var ff = data.readByte();\n\n    if (ff != 0xFF) {\n      throw new Error(\"Invalid JPEG image\");\n    }\n\n    var marker = data.readByte();\n    var length = data.readShort();\n\n    if (SOF_CODES.indexOf(marker) >= 0) {\n      // \"start of frame\" marker\n      bitsPerComponent = data.readByte();\n      height = data.readShort();\n      width = data.readShort();\n      colorSpace = data.readByte();\n      break;\n    }\n\n    data.skip(length - 2);\n  }\n\n  if (colorSpace == null) {\n    throw new Error(\"Invalid JPEG image\");\n  }\n\n  var props = {\n    Type: _(\"XObject\"),\n    Subtype: _(\"Image\"),\n    Width: width,\n    Height: height,\n    BitsPerComponent: bitsPerComponent,\n    Filter: _(\"DCTDecode\")\n  };\n\n  switch (colorSpace) {\n    case 1:\n      props.ColorSpace = _(\"DeviceGray\");\n      break;\n\n    case 3:\n      props.ColorSpace = _(\"DeviceRGB\");\n      break;\n\n    case 4:\n      props.ColorSpace = _(\"DeviceCMYK\");\n      props.Decode = [1, 0, 1, 0, 1, 0, 1, 0]; // invert colors\n\n      break;\n  }\n\n  this.asStream = function () {\n    data.offset(0);\n    var stream = new PDFStream(data, props);\n    stream._resourceName = _(\"I\" + ++RESOURCE_COUNTER);\n    return stream;\n  };\n}; // PDFRawImage will be used for images with transparency (PNG)\n\n\nvar PDFRawImage = function PDFRawImage(width, height, rgb, alpha) {\n  this.asStream = function (pdf) {\n    var mask = new PDFStream(alpha, {\n      Type: _(\"XObject\"),\n      Subtype: _(\"Image\"),\n      Width: width,\n      Height: height,\n      BitsPerComponent: 8,\n      ColorSpace: _(\"DeviceGray\")\n    }, true);\n    var stream = new PDFStream(rgb, {\n      Type: _(\"XObject\"),\n      Subtype: _(\"Image\"),\n      Width: width,\n      Height: height,\n      BitsPerComponent: 8,\n      ColorSpace: _(\"DeviceRGB\"),\n      SMask: pdf.attach(mask)\n    }, true);\n    stream._resourceName = _(\"I\" + ++RESOURCE_COUNTER);\n    return stream;\n  };\n}; /// standard fonts\n\n\nvar PDFStandardFont = function (PDFDictionary) {\n  function PDFStandardFont(name) {\n    PDFDictionary.call(this, {\n      Type: _(\"Font\"),\n      Subtype: _(\"Type1\"),\n      BaseFont: _(name)\n    });\n    this._resourceName = _(\"F\" + ++RESOURCE_COUNTER);\n  }\n\n  if (PDFDictionary) PDFStandardFont.__proto__ = PDFDictionary;\n  PDFStandardFont.prototype = Object.create(PDFDictionary && PDFDictionary.prototype);\n  PDFStandardFont.prototype.constructor = PDFStandardFont;\n\n  PDFStandardFont.prototype.encodeText = function encodeText(str) {\n    return new PDFString(String(str));\n  };\n\n  return PDFStandardFont;\n}(PDFDictionary); /// TTF fonts\n\n\nvar PDFFont = function (PDFDictionary) {\n  function PDFFont(pdf, font, props) {\n    PDFDictionary.call(this, {});\n    props = this.props;\n    props.Type = _(\"Font\");\n    props.Subtype = _(\"Type0\");\n    props.Encoding = _(\"Identity-H\");\n    this._pdf = pdf;\n    this._font = font;\n    this._sub = font.makeSubset();\n    this._resourceName = _(\"F\" + ++RESOURCE_COUNTER);\n    var head = font.head;\n    this.name = font.psName;\n    var scale = this.scale = font.scale;\n    this.bbox = [head.xMin * scale, head.yMin * scale, head.xMax * scale, head.yMax * scale];\n    this.italicAngle = font.post.italicAngle;\n    this.ascent = font.ascent * scale;\n    this.descent = font.descent * scale;\n    this.lineGap = font.lineGap * scale;\n    this.capHeight = font.os2.capHeight || this.ascent;\n    this.xHeight = font.os2.xHeight || 0;\n    this.stemV = 0;\n    this.familyClass = (font.os2.familyClass || 0) >> 8;\n    this.isSerif = this.familyClass >= 1 && this.familyClass <= 7;\n    this.isScript = this.familyClass == 10;\n    this.flags = (font.post.isFixedPitch ? 1 : 0) | (this.isSerif ? 1 << 1 : 0) | (this.isScript ? 1 << 3 : 0) | (this.italicAngle !== 0 ? 1 << 6 : 0) | 1 << 5;\n  }\n\n  if (PDFDictionary) PDFFont.__proto__ = PDFDictionary;\n  PDFFont.prototype = Object.create(PDFDictionary && PDFDictionary.prototype);\n  PDFFont.prototype.constructor = PDFFont;\n\n  PDFFont.prototype.encodeText = function encodeText(text) {\n    return new PDFHexString(this._sub.encodeText(String(text)));\n  };\n\n  PDFFont.prototype.getTextWidth = function getTextWidth(fontSize, text) {\n    var this$1 = this;\n    var width = 0,\n        codeMap = this._font.cmap.codeMap;\n\n    for (var i = 0; i < text.length; ++i) {\n      var glyphId = codeMap[text.charCodeAt(i)];\n      width += this$1._font.widthOfGlyph(glyphId || 0);\n    }\n\n    return width * fontSize / 1000;\n  };\n\n  PDFFont.prototype.beforeRender = function beforeRender() {\n    var self = this;\n    var sub = self._sub; // write the TTF data\n\n    var data = sub.render();\n    var fontStream = new PDFStream(BinaryStream(data), {\n      Length1: data.length\n    }, true);\n\n    var descriptor = self._pdf.attach(new PDFDictionary({\n      Type: _(\"FontDescriptor\"),\n      FontName: _(self._sub.psName),\n      FontBBox: self.bbox,\n      Flags: self.flags,\n      StemV: self.stemV,\n      ItalicAngle: self.italicAngle,\n      Ascent: self.ascent,\n      Descent: self.descent,\n      CapHeight: self.capHeight,\n      XHeight: self.xHeight,\n      FontFile2: self._pdf.attach(fontStream)\n    }));\n\n    var cmap = sub.ncid2ogid;\n    var firstChar = sub.firstChar;\n    var lastChar = sub.lastChar;\n    var charWidths = [];\n\n    (function loop(i, chunk) {\n      if (i <= lastChar) {\n        var gid = cmap[i];\n\n        if (gid == null) {\n          loop(i + 1);\n        } else {\n          if (!chunk) {\n            charWidths.push(i, chunk = []);\n          }\n\n          chunk.push(self._font.widthOfGlyph(gid));\n          loop(i + 1, chunk);\n        }\n      }\n    })(firstChar); // As if two dictionaries weren't enough, we need another\n    // one, the \"descendant font\".  Only that one can be of\n    // Subtype CIDFontType2.  PDF is the X11 of document\n    // formats: portable but full of legacy that nobody cares\n    // about anymore.\n\n\n    var descendant = new PDFDictionary({\n      Type: _(\"Font\"),\n      Subtype: _(\"CIDFontType2\"),\n      BaseFont: _(self._sub.psName),\n      CIDSystemInfo: new PDFDictionary({\n        Registry: new PDFString(\"Adobe\"),\n        Ordering: new PDFString(\"Identity\"),\n        Supplement: 0\n      }),\n      FontDescriptor: descriptor,\n      FirstChar: firstChar,\n      LastChar: lastChar,\n      DW: Math.round(self._font.widthOfGlyph(0)),\n      W: charWidths,\n      CIDToGIDMap: self._pdf.attach(self._makeCidToGidMap())\n    });\n    var dict = self.props;\n    dict.BaseFont = _(self._sub.psName);\n    dict.DescendantFonts = [self._pdf.attach(descendant)]; // Compute the ToUnicode map so that apps can extract\n    // meaningful text from the PDF.\n\n    var unimap = new PDFToUnicodeCmap(firstChar, lastChar, sub.subset);\n    var unimapStream = new PDFStream(makeOutput(), null, true);\n    unimapStream.data(unimap);\n    dict.ToUnicode = self._pdf.attach(unimapStream);\n  };\n\n  PDFFont.prototype._makeCidToGidMap = function _makeCidToGidMap() {\n    return new PDFStream(BinaryStream(this._sub.cidToGidMap()), null, true);\n  };\n\n  return PDFFont;\n}(PDFDictionary);\n\nvar PDFToUnicodeCmap = function (PDFValue) {\n  function PDFToUnicodeCmap(firstChar, lastChar, map) {\n    PDFValue.call(this);\n    this.firstChar = firstChar;\n    this.lastChar = lastChar;\n    this.map = map;\n  }\n\n  if (PDFValue) PDFToUnicodeCmap.__proto__ = PDFValue;\n  PDFToUnicodeCmap.prototype = Object.create(PDFValue && PDFValue.prototype);\n  PDFToUnicodeCmap.prototype.constructor = PDFToUnicodeCmap;\n\n  PDFToUnicodeCmap.prototype.render = function render(out) {\n    out.indent(\"/CIDInit /ProcSet findresource begin\");\n    out.indent(\"12 dict begin\");\n    out.indent(\"begincmap\");\n    out.indent(\"/CIDSystemInfo <<\");\n    out.indent(\"  /Registry (Adobe)\");\n    out.indent(\"  /Ordering (UCS)\");\n    out.indent(\"  /Supplement 0\");\n    out.indent(\">> def\");\n    out.indent(\"/CMapName /Adobe-Identity-UCS def\");\n    out.indent(\"/CMapType 2 def\");\n    out.indent(\"1 begincodespacerange\");\n    out.indent(\"  <0000><ffff>\");\n    out.indent(\"endcodespacerange\");\n    var self = this;\n    out.indent(self.lastChar - self.firstChar + 1, \" beginbfchar\");\n    out.withIndent(function () {\n      for (var code = self.firstChar; code <= self.lastChar; ++code) {\n        var unicode = self.map[code];\n        var str = ucs2encode([unicode]);\n        out.indent(\"<\", zeropad(code.toString(16), 4), \">\", \"<\");\n\n        for (var i = 0; i < str.length; ++i) {\n          out(zeropad(str.charCodeAt(i).toString(16), 4));\n        }\n\n        out(\">\");\n      }\n    });\n    out.indent(\"endbfchar\");\n    out.indent(\"endcmap\");\n    out.indent(\"CMapName currentdict /CMap defineresource pop\");\n    out.indent(\"end\");\n    out.indent(\"end\");\n  };\n\n  return PDFToUnicodeCmap;\n}(PDFValue); /// gradients\n\n\nfunction makeHash(a) {\n  return a.map(function (x) {\n    return isArray(x) ? makeHash(x) : typeof x == \"number\" ? (Math.round(x * 1000) / 1000).toFixed(3) : x;\n  }).join(\" \");\n}\n\nfunction cacheColorGradientFunction(pdf, r1, g1, b1, r2, g2, b2) {\n  var hash = makeHash([r1, g1, b1, r2, g2, b2]);\n  var func = pdf.GRAD_COL_FUNCTIONS[hash];\n\n  if (!func) {\n    func = pdf.GRAD_COL_FUNCTIONS[hash] = pdf.attach(new PDFDictionary({\n      FunctionType: 2,\n      Domain: [0, 1],\n      Range: [0, 1, 0, 1, 0, 1],\n      N: 1,\n      C0: [r1, g1, b1],\n      C1: [r2, g2, b2]\n    }));\n  }\n\n  return func;\n}\n\nfunction cacheOpacityGradientFunction(pdf, a1, a2) {\n  var hash = makeHash([a1, a2]);\n  var func = pdf.GRAD_OPC_FUNCTIONS[hash];\n\n  if (!func) {\n    func = pdf.GRAD_OPC_FUNCTIONS[hash] = pdf.attach(new PDFDictionary({\n      FunctionType: 2,\n      Domain: [0, 1],\n      Range: [0, 1],\n      N: 1,\n      C0: [a1],\n      C1: [a2]\n    }));\n  }\n\n  return func;\n}\n\nfunction makeGradientFunctions(pdf, stops) {\n  var hasAlpha = false;\n  var opacities = [];\n  var colors = [];\n  var offsets = [];\n  var encode = [];\n  var i, prev, cur, prevColor, curColor;\n\n  for (i = 1; i < stops.length; ++i) {\n    prev = stops[i - 1];\n    cur = stops[i];\n    prevColor = prev.color;\n    curColor = cur.color;\n    colors.push(cacheColorGradientFunction(pdf, prevColor.r, prevColor.g, prevColor.b, curColor.r, curColor.g, curColor.b));\n\n    if (prevColor.a < 1 || curColor.a < 1) {\n      hasAlpha = true;\n    }\n\n    offsets.push(cur.offset);\n    encode.push(0, 1);\n  }\n\n  if (hasAlpha) {\n    for (i = 1; i < stops.length; ++i) {\n      prev = stops[i - 1];\n      cur = stops[i];\n      prevColor = prev.color;\n      curColor = cur.color;\n      opacities.push(cacheOpacityGradientFunction(pdf, prevColor.a, curColor.a));\n    }\n  }\n\n  offsets.pop();\n  return {\n    hasAlpha: hasAlpha,\n    colors: assemble(colors),\n    opacities: hasAlpha ? assemble(opacities) : null\n  };\n\n  function assemble(funcs) {\n    if (funcs.length == 1) {\n      return funcs[0];\n    }\n\n    return {\n      FunctionType: 3,\n      Functions: funcs,\n      Domain: [0, 1],\n      Bounds: offsets,\n      Encode: encode\n    };\n  }\n}\n\nfunction cacheColorGradient(pdf, isRadial, stops, coords, funcs, box) {\n  var shading, hash; // if box is given then we have user-space coordinates, which\n  // means the gradient is designed for a certain position/size\n  // on page.  caching won't do any good.\n\n  if (!box) {\n    var a = [isRadial].concat(coords);\n    stops.forEach(function (x) {\n      a.push(x.offset, x.color.r, x.color.g, x.color.b);\n    });\n    hash = makeHash(a);\n    shading = pdf.GRAD_COL[hash];\n  }\n\n  if (!shading) {\n    shading = new PDFDictionary({\n      Type: _(\"Shading\"),\n      ShadingType: isRadial ? 3 : 2,\n      ColorSpace: _(\"DeviceRGB\"),\n      Coords: coords,\n      Domain: [0, 1],\n      Function: funcs,\n      Extend: [true, true]\n    });\n    pdf.attach(shading);\n    shading._resourceName = \"S\" + ++RESOURCE_COUNTER;\n\n    if (hash) {\n      pdf.GRAD_COL[hash] = shading;\n    }\n  }\n\n  return shading;\n}\n\nfunction cacheOpacityGradient(pdf, isRadial, stops, coords, funcs, box) {\n  var opacity, hash; // if box is given then we have user-space coordinates, which\n  // means the gradient is designed for a certain position/size\n  // on page.  caching won't do any good.\n\n  if (!box) {\n    var a = [isRadial].concat(coords);\n    stops.forEach(function (x) {\n      a.push(x.offset, x.color.a);\n    });\n    hash = makeHash(a);\n    opacity = pdf.GRAD_OPC[hash];\n  }\n\n  if (!opacity) {\n    opacity = new PDFDictionary({\n      Type: _(\"ExtGState\"),\n      AIS: false,\n      CA: 1,\n      ca: 1,\n      SMask: {\n        Type: _(\"Mask\"),\n        S: _(\"Luminosity\"),\n        G: pdf.attach(new PDFStream(\"/a0 gs /s0 sh\", {\n          Type: _(\"XObject\"),\n          Subtype: _(\"Form\"),\n          FormType: 1,\n          BBox: box ? [box.left, box.top + box.height, box.left + box.width, box.top] : [0, 1, 1, 0],\n          Group: {\n            Type: _(\"Group\"),\n            S: _(\"Transparency\"),\n            CS: _(\"DeviceGray\"),\n            I: true\n          },\n          Resources: {\n            ExtGState: {\n              a0: {\n                CA: 1,\n                ca: 1\n              }\n            },\n            Shading: {\n              s0: {\n                ColorSpace: _(\"DeviceGray\"),\n                Coords: coords,\n                Domain: [0, 1],\n                ShadingType: isRadial ? 3 : 2,\n                Function: funcs,\n                Extend: [true, true]\n              }\n            }\n          }\n        }))\n      }\n    });\n    pdf.attach(opacity);\n    opacity._resourceName = \"O\" + ++RESOURCE_COUNTER;\n\n    if (hash) {\n      pdf.GRAD_OPC[hash] = opacity;\n    }\n  }\n\n  return opacity;\n}\n\nfunction cacheGradient(pdf, gradient, box) {\n  var isRadial = gradient.type == \"radial\";\n  var funcs = makeGradientFunctions(pdf, gradient.stops);\n  var coords = isRadial ? [gradient.start.x, gradient.start.y, gradient.start.r, gradient.end.x, gradient.end.y, gradient.end.r] : [gradient.start.x, gradient.start.y, gradient.end.x, gradient.end.y];\n  var shading = cacheColorGradient(pdf, isRadial, gradient.stops, coords, funcs.colors, gradient.userSpace && box);\n  var opacity = funcs.hasAlpha ? cacheOpacityGradient(pdf, isRadial, gradient.stops, coords, funcs.opacities, gradient.userSpace && box) : null;\n  return {\n    hasAlpha: funcs.hasAlpha,\n    shading: shading,\n    opacity: opacity\n  };\n} /// page object\n\n\nvar PDFPage = function (PDFDictionary) {\n  function PDFPage(pdf, props) {\n    PDFDictionary.call(this, props);\n    this._pdf = pdf;\n    this._rcount = 0;\n    this._textMode = false;\n    this._fontResources = {};\n    this._gsResources = {};\n    this._xResources = {};\n    this._patResources = {};\n    this._shResources = {};\n    this._opacity = 1;\n    this._matrix = [1, 0, 0, 1, 0, 0];\n    this._annotations = [];\n    this._font = null;\n    this._fontSize = null;\n    this._contextStack = [];\n    props = this.props;\n    props.Type = _(\"Page\");\n    props.ProcSet = [_(\"PDF\"), _(\"Text\"), _(\"ImageB\"), _(\"ImageC\"), _(\"ImageI\")];\n    props.Resources = new PDFDictionary({\n      Font: new PDFDictionary(this._fontResources),\n      ExtGState: new PDFDictionary(this._gsResources),\n      XObject: new PDFDictionary(this._xResources),\n      Pattern: new PDFDictionary(this._patResources),\n      Shading: new PDFDictionary(this._shResources)\n    });\n    props.Annots = this._annotations;\n  }\n\n  if (PDFDictionary) PDFPage.__proto__ = PDFDictionary;\n  PDFPage.prototype = Object.create(PDFDictionary && PDFDictionary.prototype);\n  PDFPage.prototype.constructor = PDFPage;\n\n  PDFPage.prototype._out = function _out() {\n    this._content.data.apply(null, arguments);\n  };\n\n  PDFPage.prototype.transform = function transform(a, b, c, d, e, f) {\n    if (!isIdentityMatrix(arguments)) {\n      this._matrix = mmul(arguments, this._matrix);\n\n      this._out(a, \" \", b, \" \", c, \" \", d, \" \", e, \" \", f, \" cm\"); // XXX: debug\n      // this._out(\" % current matrix: \", this._matrix);\n\n\n      this._out(NL);\n    }\n  };\n\n  PDFPage.prototype.translate = function translate(dx, dy) {\n    this.transform(1, 0, 0, 1, dx, dy);\n  };\n\n  PDFPage.prototype.scale = function scale(sx, sy) {\n    this.transform(sx, 0, 0, sy, 0, 0);\n  };\n\n  PDFPage.prototype.rotate = function rotate(angle) {\n    var cos = Math.cos(angle),\n        sin = Math.sin(angle);\n    this.transform(cos, sin, -sin, cos, 0, 0);\n  };\n\n  PDFPage.prototype.beginText = function beginText() {\n    this._textMode = true;\n\n    this._out(\"BT\", NL);\n  };\n\n  PDFPage.prototype.endText = function endText() {\n    this._textMode = false;\n\n    this._out(\"ET\", NL);\n  };\n\n  PDFPage.prototype._requireTextMode = function _requireTextMode() {\n    if (!this._textMode) {\n      throw new Error(\"Text mode required; call page.beginText() first\");\n    }\n  };\n\n  PDFPage.prototype._requireFont = function _requireFont() {\n    if (!this._font) {\n      throw new Error(\"No font selected; call page.setFont() first\");\n    }\n  };\n\n  PDFPage.prototype.setFont = function setFont(font, size) {\n    this._requireTextMode();\n\n    if (font == null) {\n      font = this._font;\n    } else if (!(font instanceof PDFFont)) {\n      font = this._pdf.getFont(font);\n    }\n\n    if (size == null) {\n      size = this._fontSize;\n    }\n\n    this._fontResources[font._resourceName] = font;\n    this._font = font;\n    this._fontSize = size;\n\n    this._out(font._resourceName, \" \", size, \" Tf\", NL);\n  };\n\n  PDFPage.prototype.setTextLeading = function setTextLeading(size) {\n    this._requireTextMode();\n\n    this._out(size, \" TL\", NL);\n  };\n\n  PDFPage.prototype.setTextRenderingMode = function setTextRenderingMode(mode) {\n    this._requireTextMode();\n\n    this._out(mode, \" Tr\", NL);\n  };\n\n  PDFPage.prototype.showText = function showText(text, requestedWidth) {\n    this._requireFont();\n\n    if (text.length > 1 && requestedWidth && this._font instanceof PDFFont) {\n      var outputWidth = this._font.getTextWidth(this._fontSize, text);\n\n      var scale = requestedWidth / outputWidth * 100;\n\n      this._out(scale, \" Tz \");\n    }\n\n    this._out(this._font.encodeText(text), \" Tj\", NL);\n  };\n\n  PDFPage.prototype.showTextNL = function showTextNL(text) {\n    this._requireFont();\n\n    this._out(this._font.encodeText(text), \" '\", NL);\n  };\n\n  PDFPage.prototype.addLink = function addLink(uri, box) {\n    var ll = this._toPage({\n      x: box.left,\n      y: box.bottom\n    });\n\n    var ur = this._toPage({\n      x: box.right,\n      y: box.top\n    });\n\n    this._annotations.push(new PDFDictionary({\n      Type: _(\"Annot\"),\n      Subtype: _(\"Link\"),\n      Rect: [ll.x, ll.y, ur.x, ur.y],\n      Border: [0, 0, 0],\n      A: new PDFDictionary({\n        Type: _(\"Action\"),\n        S: _(\"URI\"),\n        URI: new PDFString(uri)\n      })\n    }));\n  };\n\n  PDFPage.prototype.setStrokeColor = function setStrokeColor(r, g, b) {\n    this._out(r, \" \", g, \" \", b, \" RG\", NL);\n  };\n\n  PDFPage.prototype.setOpacity = function setOpacity(opacity) {\n    this.setFillOpacity(opacity);\n    this.setStrokeOpacity(opacity);\n    this._opacity *= opacity;\n  };\n\n  PDFPage.prototype.setStrokeOpacity = function setStrokeOpacity(opacity) {\n    if (opacity < 1) {\n      var gs = this._pdf.getOpacityGS(this._opacity * opacity, true);\n\n      this._gsResources[gs._resourceName] = gs;\n\n      this._out(gs._resourceName, \" gs\", NL);\n    }\n  };\n\n  PDFPage.prototype.setFillColor = function setFillColor(r, g, b) {\n    this._out(r, \" \", g, \" \", b, \" rg\", NL);\n  };\n\n  PDFPage.prototype.setFillOpacity = function setFillOpacity(opacity) {\n    if (opacity < 1) {\n      var gs = this._pdf.getOpacityGS(this._opacity * opacity, false);\n\n      this._gsResources[gs._resourceName] = gs;\n\n      this._out(gs._resourceName, \" gs\", NL);\n    }\n  };\n\n  PDFPage.prototype.gradient = function gradient(gradient$1, box) {\n    this.save();\n    this.rect(box.left, box.top, box.width, box.height);\n    this.clip();\n\n    if (!gradient$1.userSpace) {\n      this.transform(box.width, 0, 0, box.height, box.left, box.top);\n    }\n\n    var g = cacheGradient(this._pdf, gradient$1, box);\n    var sname = g.shading._resourceName,\n        oname;\n    this._shResources[sname] = g.shading;\n\n    if (g.hasAlpha) {\n      oname = g.opacity._resourceName;\n      this._gsResources[oname] = g.opacity;\n\n      this._out(\"/\" + oname + \" gs \");\n    }\n\n    this._out(\"/\" + sname + \" sh\", NL);\n\n    this.restore();\n  };\n\n  PDFPage.prototype.setDashPattern = function setDashPattern(dashArray, dashPhase) {\n    this._out(dashArray, \" \", dashPhase, \" d\", NL);\n  };\n\n  PDFPage.prototype.setLineWidth = function setLineWidth(width) {\n    this._out(width, \" w\", NL);\n  };\n\n  PDFPage.prototype.setLineCap = function setLineCap(lineCap) {\n    this._out(lineCap, \" J\", NL);\n  };\n\n  PDFPage.prototype.setLineJoin = function setLineJoin(lineJoin) {\n    this._out(lineJoin, \" j\", NL);\n  };\n\n  PDFPage.prototype.setMitterLimit = function setMitterLimit(mitterLimit) {\n    this._out(mitterLimit, \" M\", NL);\n  };\n\n  PDFPage.prototype.save = function save() {\n    this._contextStack.push(this._context());\n\n    this._out(\"q\", NL);\n  };\n\n  PDFPage.prototype.restore = function restore() {\n    this._out(\"Q\", NL);\n\n    this._context(this._contextStack.pop());\n  }; // paths\n\n\n  PDFPage.prototype.moveTo = function moveTo(x, y) {\n    this._out(x, \" \", y, \" m\", NL);\n  };\n\n  PDFPage.prototype.lineTo = function lineTo(x, y) {\n    this._out(x, \" \", y, \" l\", NL);\n  };\n\n  PDFPage.prototype.bezier = function bezier(x1, y1, x2, y2, x3, y3) {\n    this._out(x1, \" \", y1, \" \", x2, \" \", y2, \" \", x3, \" \", y3, \" c\", NL);\n  };\n\n  PDFPage.prototype.bezier1 = function bezier1(x1, y1, x3, y3) {\n    this._out(x1, \" \", y1, \" \", x3, \" \", y3, \" y\", NL);\n  };\n\n  PDFPage.prototype.bezier2 = function bezier2(x2, y2, x3, y3) {\n    this._out(x2, \" \", y2, \" \", x3, \" \", y3, \" v\", NL);\n  };\n\n  PDFPage.prototype.close = function close() {\n    this._out(\"h\", NL);\n  };\n\n  PDFPage.prototype.rect = function rect(x, y, w, h) {\n    this._out(x, \" \", y, \" \", w, \" \", h, \" re\", NL);\n  };\n\n  PDFPage.prototype.ellipse = function ellipse(x, y, rx, ry) {\n    function _X(v) {\n      return x + v;\n    }\n\n    function _Y(v) {\n      return y + v;\n    } // how to get to the \"magic number\" is explained here:\n    // http://www.whizkidtech.redprince.net/bezier/circle/kappa/\n\n\n    var k = 0.5522847498307936;\n    this.moveTo(_X(0), _Y(ry));\n    this.bezier(_X(rx * k), _Y(ry), _X(rx), _Y(ry * k), _X(rx), _Y(0));\n    this.bezier(_X(rx), _Y(-ry * k), _X(rx * k), _Y(-ry), _X(0), _Y(-ry));\n    this.bezier(_X(-rx * k), _Y(-ry), _X(-rx), _Y(-ry * k), _X(-rx), _Y(0));\n    this.bezier(_X(-rx), _Y(ry * k), _X(-rx * k), _Y(ry), _X(0), _Y(ry));\n  };\n\n  PDFPage.prototype.circle = function circle(x, y, r) {\n    this.ellipse(x, y, r, r);\n  };\n\n  PDFPage.prototype.stroke = function stroke() {\n    this._out(\"S\", NL);\n  };\n\n  PDFPage.prototype.nop = function nop() {\n    this._out(\"n\", NL);\n  };\n\n  PDFPage.prototype.clip = function clip() {\n    this._out(\"W n\", NL);\n  };\n\n  PDFPage.prototype.clipStroke = function clipStroke() {\n    this._out(\"W S\", NL);\n  };\n\n  PDFPage.prototype.closeStroke = function closeStroke() {\n    this._out(\"s\", NL);\n  };\n\n  PDFPage.prototype.fill = function fill() {\n    this._out(\"f\", NL);\n  };\n\n  PDFPage.prototype.fillStroke = function fillStroke() {\n    this._out(\"B\", NL);\n  };\n\n  PDFPage.prototype.drawImage = function drawImage(url) {\n    var img = this._pdf.getImage(url);\n\n    if (img) {\n      // the result can be null for a cross-domain image\n      this._xResources[img._resourceName] = img;\n\n      this._out(img._resourceName, \" Do\", NL);\n    }\n  };\n\n  PDFPage.prototype.comment = function comment(txt) {\n    var self = this;\n    txt.split(/\\r?\\n/g).forEach(function (line) {\n      self._out(\"% \", line, NL);\n    });\n  }; // internal\n\n\n  PDFPage.prototype._context = function _context(val) {\n    if (val != null) {\n      this._opacity = val.opacity;\n      this._matrix = val.matrix;\n    } else {\n      return {\n        opacity: this._opacity,\n        matrix: this._matrix\n      };\n    }\n  };\n\n  PDFPage.prototype._toPage = function _toPage(p) {\n    var m = this._matrix;\n    var a = m[0],\n        b = m[1],\n        c = m[2],\n        d = m[3],\n        e = m[4],\n        f = m[5];\n    return {\n      x: a * p.x + c * p.y + e,\n      y: b * p.x + d * p.y + f\n    };\n  };\n\n  return PDFPage;\n}(PDFDictionary);\n\nfunction unquote(str) {\n  return str.replace(/^\\s*(['\"])(.*)\\1\\s*$/, \"$2\");\n}\n\nfunction parseFontDef(fontdef) {\n  // XXX: this is very crude for now and buggy.  Proper parsing is quite involved.\n  var rx = /^\\s*((normal|italic)\\s+)?((normal|small-caps)\\s+)?((normal|bold|\\d+)\\s+)?(([0-9.]+)(px|pt))(\\/(([0-9.]+)(px|pt)|normal))?\\s+(.*?)\\s*$/i;\n  var m = rx.exec(fontdef);\n\n  if (!m) {\n    return {\n      fontSize: 12,\n      fontFamily: \"sans-serif\"\n    };\n  }\n\n  var fontSize = m[8] ? parseInt(m[8], 10) : 12;\n  return {\n    italic: m[2] && m[2].toLowerCase() == \"italic\",\n    variant: m[4],\n    bold: m[6] && /bold|700/i.test(m[6]),\n    fontSize: fontSize,\n    lineHeight: m[12] ? m[12] == \"normal\" ? fontSize : parseInt(m[12], 10) : null,\n    fontFamily: m[14].split(/\\s*,\\s*/g).map(unquote)\n  };\n}\n\nfunction getFontURL(style) {\n  function mkFamily(name) {\n    if (style.bold) {\n      name += \"|bold\";\n    }\n\n    if (style.italic) {\n      name += \"|italic\";\n    }\n\n    return name.toLowerCase();\n  }\n\n  var fontFamily = style.fontFamily;\n  var name, url;\n\n  if (fontFamily instanceof Array) {\n    for (var i = 0; i < fontFamily.length; ++i) {\n      name = mkFamily(fontFamily[i]);\n      url = FONT_MAPPINGS[name];\n\n      if (url) {\n        break;\n      }\n    }\n  } else {\n    url = FONT_MAPPINGS[fontFamily.toLowerCase()];\n  }\n\n  while (typeof url == \"function\") {\n    url = url();\n  }\n\n  if (!url) {\n    url = \"Times-Roman\";\n  }\n\n  return url;\n}\n\nvar FONT_MAPPINGS = {\n  \"serif\": \"Times-Roman\",\n  \"serif|bold\": \"Times-Bold\",\n  \"serif|italic\": \"Times-Italic\",\n  \"serif|bold|italic\": \"Times-BoldItalic\",\n  \"sans-serif\": \"Helvetica\",\n  \"sans-serif|bold\": \"Helvetica-Bold\",\n  \"sans-serif|italic\": \"Helvetica-Oblique\",\n  \"sans-serif|bold|italic\": \"Helvetica-BoldOblique\",\n  \"monospace\": \"Courier\",\n  \"monospace|bold\": \"Courier-Bold\",\n  \"monospace|italic\": \"Courier-Oblique\",\n  \"monospace|bold|italic\": \"Courier-BoldOblique\",\n  \"zapfdingbats\": \"ZapfDingbats\",\n  \"zapfdingbats|bold\": \"ZapfDingbats\",\n  \"zapfdingbats|italic\": \"ZapfDingbats\",\n  \"zapfdingbats|bold|italic\": \"ZapfDingbats\"\n};\n\nfunction fontAlias(alias, name) {\n  alias = alias.toLowerCase();\n\n  FONT_MAPPINGS[alias] = function () {\n    return FONT_MAPPINGS[name];\n  };\n\n  FONT_MAPPINGS[alias + \"|bold\"] = function () {\n    return FONT_MAPPINGS[name + \"|bold\"];\n  };\n\n  FONT_MAPPINGS[alias + \"|italic\"] = function () {\n    return FONT_MAPPINGS[name + \"|italic\"];\n  };\n\n  FONT_MAPPINGS[alias + \"|bold|italic\"] = function () {\n    return FONT_MAPPINGS[name + \"|bold|italic\"];\n  };\n} // Let's define some common names to an appropriate replacement.\n// These are overridable via pdf.defineFont, should the user want to\n// include the proper versions.\n\n\nfontAlias(\"Times New Roman\", \"serif\");\nfontAlias(\"Courier New\", \"monospace\");\nfontAlias(\"Arial\", \"sans-serif\");\nfontAlias(\"Helvetica\", \"sans-serif\");\nfontAlias(\"Verdana\", \"sans-serif\");\nfontAlias(\"Tahoma\", \"sans-serif\");\nfontAlias(\"Georgia\", \"sans-serif\");\nfontAlias(\"Monaco\", \"monospace\");\nfontAlias(\"Andale Mono\", \"monospace\");\n\nfunction defineFont(name, url) {\n  if (arguments.length == 1) {\n    for (var i in name) {\n      if (hasOwnProperty(name, i)) {\n        defineFont(i, name[i]);\n      }\n    }\n  } else {\n    name = name.toLowerCase();\n    FONT_MAPPINGS[name] = url; // special handling for DejaVu fonts: if they get defined,\n    // let them also replace the default families, for good\n    // Unicode support out of the box.\n\n    switch (name) {\n      case \"dejavu sans\":\n        FONT_MAPPINGS[\"sans-serif\"] = url;\n        break;\n\n      case \"dejavu sans|bold\":\n        FONT_MAPPINGS[\"sans-serif|bold\"] = url;\n        break;\n\n      case \"dejavu sans|italic\":\n        FONT_MAPPINGS[\"sans-serif|italic\"] = url;\n        break;\n\n      case \"dejavu sans|bold|italic\":\n        FONT_MAPPINGS[\"sans-serif|bold|italic\"] = url;\n        break;\n\n      case \"dejavu serif\":\n        FONT_MAPPINGS[\"serif\"] = url;\n        break;\n\n      case \"dejavu serif|bold\":\n        FONT_MAPPINGS[\"serif|bold\"] = url;\n        break;\n\n      case \"dejavu serif|italic\":\n        FONT_MAPPINGS[\"serif|italic\"] = url;\n        break;\n\n      case \"dejavu serif|bold|italic\":\n        FONT_MAPPINGS[\"serif|bold|italic\"] = url;\n        break;\n\n      case \"dejavu mono\":\n        FONT_MAPPINGS[\"monospace\"] = url;\n        break;\n\n      case \"dejavu mono|bold\":\n        FONT_MAPPINGS[\"monospace|bold\"] = url;\n        break;\n\n      case \"dejavu mono|italic\":\n        FONT_MAPPINGS[\"monospace|italic\"] = url;\n        break;\n\n      case \"dejavu mono|bold|italic\":\n        FONT_MAPPINGS[\"monospace|bold|italic\"] = url;\n        break;\n    }\n  }\n}\n\nfunction mmul(a, b) {\n  var a1 = a[0],\n      b1 = a[1],\n      c1 = a[2],\n      d1 = a[3],\n      e1 = a[4],\n      f1 = a[5];\n  var a2 = b[0],\n      b2 = b[1],\n      c2 = b[2],\n      d2 = b[3],\n      e2 = b[4],\n      f2 = b[5];\n  return [a1 * a2 + b1 * c2, a1 * b2 + b1 * d2, c1 * a2 + d1 * c2, c1 * b2 + d1 * d2, e1 * a2 + f1 * c2 + e2, e1 * b2 + f1 * d2 + f2];\n}\n\nfunction isIdentityMatrix(m) {\n  return m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0;\n}\n\nvar TEXT_RENDERING_MODE = {\n  fill: 0,\n  stroke: 1,\n  fillAndStroke: 2,\n  invisible: 3,\n  fillAndClip: 4,\n  strokeAndClip: 5,\n  fillStrokeClip: 6,\n  clip: 7\n};\nexport { PDFDocument as Document, BinaryStream, defineFont, parseFontDef, getFontURL, loadFonts, loadImages, getPaperOptions, clearImageCache, TEXT_RENDERING_MODE };","map":{"version":3,"names":["BinaryStream","ucs2encode","base64ToUint8Array","HAS_TYPED_ARRAYS","support","TTFFont","deflate","supportsDeflate","encodeUTF16BE","BOM","encodeBase64","browser","NL","RESOURCE_COUNTER","PAPER_SIZE","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","c10","executive","folio","legal","letter","tabloid","makeOutput","indentLevel","output","out","arguments$1","arguments","i","length","x","undefined","Error","PDFValue","beforeRender","render","isArray","renderArray","isDate","renderDate","isNaN","num","toFixed","indexOf","replace","writeString","test","String","get","write","PDFDictionary","writeData","data","withIndent","f","indent","pad","apply","offset","toString","stream","wrapObject","value","id","renderValue","renderFull","_offset","call","getPaperOptions","getOption","options","key","def","paperSize","toLowerCase","unitsToPoints","Math","max","min","margin","left","top","right","bottom","FONT_CACHE","loadBinary","url","cont","m","msie","exec","substr","error","window","console","log","req","XMLHttpRequest","open","responseType","onload","status","Uint8Array","response","VBArray","responseBody","toArray","onerror","send","loadFont","font","IMAGE_CACHE","clearImageCache","loadImage","size","img","bloburl","blob","Image","crossOrigin","xhr","mozilla","type","reader","FileReader","doc","DOMParser","parseFromString","result","svg","documentElement","getAttribute","URL","createObjectURL","_load","setAttribute","width","height","xml","XMLSerializer","serializeToString","dataURL","readAsText","_onerror","src","complete","_onload","_trycanvas","canvas","document","createElement","ctx","getContext","drawImage","imgdata","getImageData","ex","revokeObjectURL","hasAlpha","rgb","alpha","rawbytes","writeByte","a","keepPNG","PDFRawImage","toDataURL","jpegQuality","writeBase64","PDFJpegImage","substring","upscale","readAsArrayBuffer","manyLoader","loadOne","urls","callback","n","next","loadFonts","loadImages","images","Object","assign","keys","forEach","PDFDocument","self","objcount","objects","name","defval","attach","push","pages","FONTS","IMAGES","GRAD_COL_FUNCTIONS","GRAD_OPC_FUNCTIONS","GRAD_COL","GRAD_OPC","catalog","PDFCatalog","pageTree","PDFPageTree","nameTree","JavaScript","Names","PDFString","S","_","JS","props","setPages","info","Producer","Title","Author","Subject","Keywords","Creator","CreationDate","Date","addPage","paperOptions","contentWidth","contentHeight","content","PDFStream","Contents","Parent","MediaBox","page","PDFPage","_content","transform","translate","rect","clip","xrefOffset","zeropad","Size","Root","Info","prototype","getFont","PDFStandardFont","PDFFont","getImage","asStream","getOpacityGS","opacity","forStroke","parseFloat","cache","_opacityGSCache","gs","Type","CA","ca","_resourceName","dict","str","len","ch","hasOwnProperty","obj","Array","date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","mm2pt","mm","cm2pt","cm","in2pt","inch","utf16be","Boolean","__proto__","create","constructor","txt","code","charCodeAt","PDFHexString","this$1","PDFName","escape","c","PDFName_cache","empty","compress","tmp","Filter","unshift","Length","pagesObj","Pages","Kids","Count","pageObj","SOF_CODES","colorSpace","bitsPerComponent","soi","readShort","eof","ff","readByte","marker","skip","Subtype","Width","Height","BitsPerComponent","ColorSpace","Decode","pdf","mask","SMask","BaseFont","encodeText","Encoding","_pdf","_font","_sub","makeSubset","head","psName","scale","bbox","xMin","yMin","xMax","yMax","italicAngle","post","ascent","descent","lineGap","capHeight","os2","xHeight","stemV","familyClass","isSerif","isScript","flags","isFixedPitch","text","getTextWidth","fontSize","codeMap","cmap","glyphId","widthOfGlyph","sub","fontStream","Length1","descriptor","FontName","FontBBox","Flags","StemV","ItalicAngle","Ascent","Descent","CapHeight","XHeight","FontFile2","ncid2ogid","firstChar","lastChar","charWidths","loop","chunk","gid","descendant","CIDSystemInfo","Registry","Ordering","Supplement","FontDescriptor","FirstChar","LastChar","DW","round","W","CIDToGIDMap","_makeCidToGidMap","DescendantFonts","unimap","PDFToUnicodeCmap","subset","unimapStream","ToUnicode","cidToGidMap","map","unicode","makeHash","join","cacheColorGradientFunction","r1","g1","r2","g2","hash","func","FunctionType","Domain","Range","N","C0","C1","cacheOpacityGradientFunction","makeGradientFunctions","stops","opacities","colors","offsets","encode","prev","cur","prevColor","curColor","color","r","g","b","pop","assemble","funcs","Functions","Bounds","Encode","cacheColorGradient","isRadial","coords","box","shading","concat","ShadingType","Coords","Function","Extend","cacheOpacityGradient","AIS","G","FormType","BBox","Group","CS","I","Resources","ExtGState","Shading","s0","cacheGradient","gradient","start","y","end","userSpace","_rcount","_textMode","_fontResources","_gsResources","_xResources","_patResources","_shResources","_opacity","_matrix","_annotations","_fontSize","_contextStack","ProcSet","Font","XObject","Pattern","Annots","_out","d","e","isIdentityMatrix","mmul","dx","dy","sx","sy","rotate","angle","cos","sin","beginText","endText","_requireTextMode","_requireFont","setFont","setTextLeading","setTextRenderingMode","mode","showText","requestedWidth","outputWidth","showTextNL","addLink","uri","ll","_toPage","ur","Rect","Border","A","URI","setStrokeColor","setOpacity","setFillOpacity","setStrokeOpacity","setFillColor","gradient$1","save","sname","oname","restore","setDashPattern","dashArray","dashPhase","setLineWidth","setLineCap","lineCap","setLineJoin","lineJoin","setMitterLimit","mitterLimit","_context","moveTo","lineTo","bezier","x1","y1","x2","y2","x3","y3","bezier1","bezier2","close","w","h","ellipse","rx","ry","_X","v","_Y","k","circle","stroke","nop","clipStroke","closeStroke","fill","fillStroke","comment","split","line","val","matrix","p","unquote","parseFontDef","fontdef","fontFamily","parseInt","italic","variant","bold","lineHeight","getFontURL","style","mkFamily","FONT_MAPPINGS","fontAlias","alias","defineFont","d1","e1","f1","d2","e2","f2","TEXT_RENDERING_MODE","fillAndStroke","invisible","fillAndClip","strokeAndClip","fillStrokeClip","Document"],"sources":["C:/Users/asana/Documents/TEC/Semestre 5/Seguridad_Informatica/ModuloReact/Admin/frontend/node_modules/@progress/kendo-drawing/dist/es/pdf/core.js"],"sourcesContent":["/* eslint-disable no-multi-spaces, key-spacing, indent, camelcase, space-before-blocks, eqeqeq, brace-style */\n/* eslint-disable space-infix-ops, space-before-function-paren, array-bracket-spacing, object-curly-spacing */\n/* eslint-disable no-nested-ternary, max-params, default-case, no-else-return, no-empty */\n/* eslint-disable no-param-reassign, no-var, block-scoped-var */\n\nimport { BinaryStream, ucs2encode, base64ToUint8Array, HAS_TYPED_ARRAYS } from \"./utils\";\nimport { support } from '../common';\nimport { TTFFont } from \"./ttf\";\nimport { deflate, supportsDeflate } from './deflate';\nimport { encodeUTF16BE, BOM } from \"../util/encode-utf\";\nimport { encodeBase64 } from \"../util\";\n\nvar browser = support.browser;\nvar NL = \"\\n\";\n\nvar RESOURCE_COUNTER = 0;\n\nvar PAPER_SIZE = {\n    a0        : [ 2383.94 , 3370.39 ],\n    a1        : [ 1683.78 , 2383.94 ],\n    a2        : [ 1190.55 , 1683.78 ],\n    a3        : [ 841.89  , 1190.55 ],\n    a4        : [ 595.28  , 841.89  ],\n    a5        : [ 419.53  , 595.28  ],\n    a6        : [ 297.64  , 419.53  ],\n    a7        : [ 209.76  , 297.64  ],\n    a8        : [ 147.40  , 209.76  ],\n    a9        : [ 104.88  , 147.40  ],\n    a10       : [ 73.70   , 104.88  ],\n    b0        : [ 2834.65 , 4008.19 ],\n    b1        : [ 2004.09 , 2834.65 ],\n    b2        : [ 1417.32 , 2004.09 ],\n    b3        : [ 1000.63 , 1417.32 ],\n    b4        : [ 708.66  , 1000.63 ],\n    b5        : [ 498.90  , 708.66  ],\n    b6        : [ 354.33  , 498.90  ],\n    b7        : [ 249.45  , 354.33  ],\n    b8        : [ 175.75  , 249.45  ],\n    b9        : [ 124.72  , 175.75  ],\n    b10       : [ 87.87   , 124.72  ],\n    c0        : [ 2599.37 , 3676.54 ],\n    c1        : [ 1836.85 , 2599.37 ],\n    c2        : [ 1298.27 , 1836.85 ],\n    c3        : [ 918.43  , 1298.27 ],\n    c4        : [ 649.13  , 918.43  ],\n    c5        : [ 459.21  , 649.13  ],\n    c6        : [ 323.15  , 459.21  ],\n    c7        : [ 229.61  , 323.15  ],\n    c8        : [ 161.57  , 229.61  ],\n    c9        : [ 113.39  , 161.57  ],\n    c10       : [ 79.37   , 113.39  ],\n    executive : [ 521.86  , 756.00  ],\n    folio     : [ 612.00  , 936.00  ],\n    legal     : [ 612.00  , 1008.00 ],\n    letter    : [ 612.00  , 792.00  ],\n    tabloid   : [ 792.00  , 1224.00 ]\n};\n\nfunction makeOutput() {\n    var indentLevel = 0, output = BinaryStream();\n    function out() {\n        var arguments$1 = arguments;\n\n        for (var i = 0; i < arguments.length; ++i) {\n            var x = arguments$1[i];\n            if (x === undefined) {\n                throw new Error(\"Cannot output undefined to PDF\");\n            }\n            else if (x instanceof PDFValue) {\n                x.beforeRender(out);\n                x.render(out);\n            }\n            else if (isArray(x)) {\n                renderArray(x, out);\n            }\n            else if (isDate(x)) {\n                renderDate(x, out);\n            }\n            else if (typeof x == \"number\") {\n                if (isNaN(x)) {\n                    throw new Error(\"Cannot output NaN to PDF\");\n                }\n                // make sure it doesn't end up in exponent notation\n                var num = x.toFixed(7);\n                if (num.indexOf(\".\") >= 0) {\n                    num = num.replace(/\\.?0+$/, \"\");\n                }\n                if (num == \"-0\") {\n                    num = \"0\";\n                }\n                output.writeString(num);\n            }\n            else if (/string|boolean/.test(typeof x)) {\n                output.writeString(String(x));\n            }\n            else if (typeof x.get == \"function\") {\n                output.write(x.get());\n            }\n            else if (typeof x == \"object\") {\n                if (!x) {\n                    output.writeString(\"null\");\n                } else {\n                    out(new PDFDictionary(x));\n                }\n            }\n        }\n    }\n    out.writeData = function(data) {\n        output.write(data);\n    };\n    out.withIndent = function(f) {\n        ++indentLevel;\n        f(out);\n        --indentLevel;\n    };\n    out.indent = function() {\n        out(NL, pad(\"\", indentLevel * 2, \"  \"));\n        out.apply(null, arguments);\n    };\n    out.offset = function() {\n        return output.offset();\n    };\n    out.toString = function() {\n        throw new Error(\"FIX CALLER\");\n    };\n    out.get = function() {\n        return output.get();\n    };\n    out.stream = function() {\n        return output;\n    };\n    return out;\n}\n\nfunction wrapObject(value, id) {\n    var beforeRender = value.beforeRender;\n    var renderValue = value.render;\n\n    value.beforeRender = function(){};\n\n    value.render = function(out) {\n        out(id, \" 0 R\");\n    };\n\n    value.renderFull = function(out) {\n        value._offset = out.offset();\n        out(id, \" 0 obj \");\n        beforeRender.call(value, out);\n        renderValue.call(value, out);\n        out(\" endobj\");\n    };\n}\n\nfunction getPaperOptions(getOption) {\n    if (typeof getOption != \"function\") {\n        var options = getOption;\n        getOption = function(key, def) {\n            return key in options ? options[key] : def;\n        };\n    }\n    var paperSize = getOption(\"paperSize\", PAPER_SIZE.a4);\n    if (!paperSize) {\n        return {};\n    }\n    if (typeof paperSize == \"string\") {\n        paperSize = PAPER_SIZE[paperSize.toLowerCase()];\n        if (paperSize == null) {\n            throw new Error(\"Unknown paper size\");\n        }\n    }\n\n    paperSize[0] = unitsToPoints(paperSize[0]);\n    paperSize[1] = unitsToPoints(paperSize[1]);\n\n    if (getOption(\"landscape\", false)) {\n        paperSize = [\n            Math.max(paperSize[0], paperSize[1]),\n            Math.min(paperSize[0], paperSize[1])\n        ];\n    }\n\n    var margin = getOption(\"margin\");\n    if (margin) {\n        if (typeof margin == \"string\" || typeof margin == \"number\") {\n            margin = unitsToPoints(margin, 0);\n            margin = { left: margin, top: margin, right: margin, bottom: margin };\n        } else {\n            margin = {\n                left   : unitsToPoints(margin.left, 0),\n                top    : unitsToPoints(margin.top, 0),\n                right  : unitsToPoints(margin.right, 0),\n                bottom : unitsToPoints(margin.bottom, 0)\n            };\n        }\n        if (getOption(\"addMargin\")) {\n            paperSize[0] += margin.left + margin.right;\n            paperSize[1] += margin.top + margin.bottom;\n        }\n    }\n    return { paperSize: paperSize, margin: margin };\n}\n\nvar FONT_CACHE = {\n    \"Times-Roman\"           : true,\n    \"Times-Bold\"            : true,\n    \"Times-Italic\"          : true,\n    \"Times-BoldItalic\"      : true,\n    \"Helvetica\"             : true,\n    \"Helvetica-Bold\"        : true,\n    \"Helvetica-Oblique\"     : true,\n    \"Helvetica-BoldOblique\" : true,\n    \"Courier\"               : true,\n    \"Courier-Bold\"          : true,\n    \"Courier-Oblique\"       : true,\n    \"Courier-BoldOblique\"   : true,\n    \"Symbol\"                : true,\n    \"ZapfDingbats\"          : true\n};\n\nfunction loadBinary(url, cont) {\n    // IE throws Accesss denied error for Data URIs\n    var m;\n    if (browser.msie && (m = /^data:.*?;base64,/i.exec(url))) {\n        cont(base64ToUint8Array(url.substr(m[0].length)));\n        return;\n    }\n\n    function error() {\n        if (window.console) {\n            if (window.console.error) {\n                window.console.error(\"Cannot load URL: %s\", url);\n            } else {\n                window.console.log(\"Cannot load URL: %s\", url);\n            }\n        }\n        cont(null);\n    }\n    var req = new XMLHttpRequest();\n    req.open('GET', url, true);\n    if (HAS_TYPED_ARRAYS) {\n        req.responseType = \"arraybuffer\";\n    }\n    req.onload = function() {\n        if (req.status == 200 || req.status == 304) {\n            if (HAS_TYPED_ARRAYS) {\n                cont(new Uint8Array(req.response));\n            } else {\n                cont(new window.VBArray(req.responseBody).toArray()); // IE9 only\n            }\n        } else {\n            error();\n        }\n    };\n    req.onerror = error;\n    req.send(null);\n}\n\nfunction loadFont(url, cont) {\n    var font = FONT_CACHE[url];\n    if (font) {\n        cont(font);\n    } else {\n        loadBinary(url, function(data){\n            if (data == null) {\n                throw new Error(\"Cannot load font from \" + url);\n            } else {\n                var font = new TTFFont(data);\n                FONT_CACHE[url] = font;\n                cont(font);\n            }\n        });\n    }\n}\n\nvar IMAGE_CACHE = {};\n\nfunction clearImageCache() {\n    IMAGE_CACHE = {};\n}\n\nfunction loadImage(url, size, cont, options) {\n    var img = IMAGE_CACHE[url], bloburl, blob;\n    if (img) {\n        cont(img);\n    } else {\n        img = new Image();\n        if (!(/^data:/i.test(url))) {\n            img.crossOrigin = \"Anonymous\";\n        }\n        if (HAS_TYPED_ARRAYS && !(/^data:/i.test(url))) {\n            // IE10 fails to load images from another domain even when the server sends the\n            // proper CORS headers.  a XHR, however, will be able to load the data.\n            // http://stackoverflow.com/a/19734516/154985\n            //\n            // On the other hand, it's worth doing it this way for all browsers which support\n            // responseType = \"blob\" (HAS_TYPED_ARRAYS will be true), because we can inspect the\n            // mime type and if it's a JPEG (very common case) we can save a lot of time in\n            // _load below.\n            var xhr = new XMLHttpRequest();\n            xhr.onload = function() {\n                blob = xhr.response;\n                if (browser.mozilla && blob.type == \"image/svg+xml\") {\n                    // Firefox won't render SVGs that don't contain width and height attributes.\n                    var reader = new FileReader();\n                    reader.onload = function() {\n                        var doc = new window.DOMParser().parseFromString(this.result, \"image/svg+xml\");\n                        var svg = doc.documentElement;\n                        if (svg.getAttribute(\"width\") && svg.getAttribute(\"height\")) {\n                            // we're good, continue with the existing blob.\n                            bloburl = URL.createObjectURL(blob);\n                            _load(bloburl);\n                        } else {\n                            svg.setAttribute(\"width\", size.width);\n                            svg.setAttribute(\"height\", size.height);\n                            var xml = new window.XMLSerializer().serializeToString(svg);\n                            var dataURL = \"data:image/svg+xml;base64,\" + (encodeBase64(xml));\n                            _load(dataURL);\n                        }\n                    };\n                    reader.readAsText(blob);\n                } else {\n                    bloburl = URL.createObjectURL(blob);\n                    _load(bloburl);\n                }\n            };\n            xhr.onerror = _onerror;\n            xhr.open(\"GET\", url, true);\n            xhr.responseType = \"blob\";\n            xhr.send();\n        } else {\n            _load(url);\n        }\n    }\n\n    function _load(url) {\n        img.src = url;\n        if (img.complete && !browser.msie) {\n            // IE, bless its little heart, says img.complete == true even though the image is\n            // not loaded (width=0), therefore we must go the onload route (ticket 929635).\n            _onload.call(img);\n        } else {\n            img.onload = _onload;\n            img.onerror = _onerror;\n        }\n    }\n\n    function _trycanvas() {\n        if (!size) {\n            size = { width: img.width, height: img.height };\n        }\n\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = size.width;\n        canvas.height = size.height;\n\n        var ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(img, 0, 0, size.width, size.height);\n\n        var imgdata;\n        try {\n            imgdata = ctx.getImageData(0, 0, size.width, size.height);\n        } catch (ex) {\n            // it tainted the canvas -- can't draw it.\n            _onerror();\n            return;\n        } finally {\n            if (bloburl) {\n                URL.revokeObjectURL(bloburl);\n            }\n        }\n\n        // in case it contains transparency, we must separate rgb data from the alpha\n        // channel and create a PDFRawImage image with opacity.  otherwise we can use a\n        // PDFJpegImage.\n        //\n        // to do this in one step, we create the rgb and alpha streams anyway, even if\n        // we might end up not using them if hasAlpha remains false.\n\n        var hasAlpha = false, rgb = BinaryStream(), alpha = BinaryStream();\n        var rawbytes = imgdata.data;\n        var i = 0;\n        while (i < rawbytes.length) {\n            rgb.writeByte(rawbytes[i++]);\n            rgb.writeByte(rawbytes[i++]);\n            rgb.writeByte(rawbytes[i++]);\n            var a = rawbytes[i++];\n            if (a < 255) {\n                hasAlpha = true;\n            }\n            alpha.writeByte(a);\n        }\n\n        if (hasAlpha || options.keepPNG) {\n            img = new PDFRawImage(size.width, size.height, rgb, alpha);\n        } else {\n            // no transparency, encode as JPEG.\n            var data = canvas.toDataURL(\"image/jpeg\", options.jpegQuality);\n            data = data.substr(data.indexOf(\";base64,\") + 8);\n\n            var stream = BinaryStream();\n            stream.writeBase64(data);\n            img = new PDFJpegImage(stream);\n        }\n\n        cont(IMAGE_CACHE[url] = img);\n    }\n\n    function _onerror() {\n        cont(IMAGE_CACHE[url] = \"ERROR\");\n    }\n\n    function _onload() {\n        if (size) {\n            var svg = (blob && blob.type === 'image/svg+xml') || (\n              /^data:image\\/svg\\+xml;/i.test(this.src.substring(0, 19))\n            );\n\n            var upscale = size.width >= img.width || size.height >= img.height;\n\n            // Use the original image if requested size is bigger than the source,\n            // unless it's an SVG that can be upscaled.\n            if (!svg && upscale) {\n                size = null;\n            }\n        }\n        if (!size && blob && /^image\\/jpe?g$/i.test(blob.type)) {\n            // If we know we got a JPEG, we can skip the process of rendering it to a\n            // canvas, getting the pixel data, searching for transparency we know we won't\n            // find, getting back a data URI and then decoding the BASE64 to finally get the\n            // binary we already have.  Also, we avoid downgrading the image quality, with\n            // the possible drawback of making a bigger PDF; still, seems legit.\n            //\n            // Besides saving a lot of work, this also reuses the buffer memory\n            // (BinaryStream does not create a copy), potentially saving some GC cycles.\n            var reader = new FileReader();\n            reader.onload = function() {\n                try {\n                    var img = new PDFJpegImage(BinaryStream(new Uint8Array(this.result)));\n                    URL.revokeObjectURL(bloburl);\n                    cont(IMAGE_CACHE[url] = img);\n                } catch (ex) {\n                    // if there's an error parsing the JPEG stream, it could be due to a\n                    // misconfigured server (improper content-type:\n                    // https://github.com/telerik/kendo-ui-core/issues/4184).  If that's the case,\n                    // the canvas will still be able to draw it.\n                    _trycanvas();\n                }\n            };\n            reader.readAsArrayBuffer(blob);\n        } else {\n            _trycanvas();\n        }\n    }\n}\n\nfunction manyLoader(loadOne) {\n    return function(urls, callback) {\n        var n = urls.length, i = n;\n        if (n === 0) {\n            return callback();\n        }\n        function next() {\n            if (--n === 0) {\n                callback();\n            }\n        }\n        while (i-- > 0) {\n            loadOne(urls[i], next);\n        }\n    };\n}\n\nvar loadFonts = manyLoader(loadFont);\nvar loadImages = function(images, callback, options) {\n    options = Object.assign({\n        jpegQuality : 0.92,\n        keepPNG     : false\n    }, options);\n    var urls = Object.keys(images), n = urls.length;\n    if (n === 0) {\n        return callback();\n    }\n    function next() {\n        if (--n === 0) {\n            callback();\n        }\n    }\n    urls.forEach(function(url){\n        loadImage(url, images[url], next, options);\n    });\n};\n\nvar PDFDocument = function PDFDocument (options) {\n    var self = this;\n    var out = makeOutput();\n    var objcount = 0;\n    var objects = [];\n\n    function getOption(name, defval) {\n        return (options && options[name] != null) ? options[name] : defval;\n    }\n\n    self.getOption = getOption;\n\n    self.attach = function(value) {\n        if (objects.indexOf(value) < 0) {\n            wrapObject(value, ++objcount);\n            objects.push(value);\n        }\n        return value;\n    };\n\n    self.pages = [];\n\n    self.FONTS = {};\n    self.IMAGES = {};\n    self.GRAD_COL_FUNCTIONS = {}; // cache for color gradient functions\n    self.GRAD_OPC_FUNCTIONS = {}; // cache for opacity gradient functions\n    self.GRAD_COL = {}; // cache for whole color gradient objects\n    self.GRAD_OPC = {}; // cache for whole opacity gradient objects\n\n    var catalog = self.attach(new PDFCatalog());\n    var pageTree = self.attach(new PDFPageTree());\n\n    if (getOption(\"autoPrint\")) {\n        var nameTree = {};\n        nameTree.JavaScript = new PDFDictionary({ Names: [\n            new PDFString(\"JS\"), self.attach(new PDFDictionary({\n                S: _(\"JavaScript\"),\n                JS: new PDFString(\"print(true);\")\n            }))\n        ] });\n        catalog.props.Names = new PDFDictionary(nameTree);\n    }\n\n    catalog.setPages(pageTree);\n\n    var info = self.attach(new PDFDictionary({\n        Producer : new PDFString(getOption(\"producer\", \"Kendo UI PDF Generator\"), true), // XXX: kendo.version?\n        Title    : new PDFString(getOption(\"title\", \"\"), true),\n        Author   : new PDFString(getOption(\"author\", \"\"), true),\n        Subject  : new PDFString(getOption(\"subject\", \"\"), true),\n        Keywords : new PDFString(getOption(\"keywords\", \"\"), true),\n        Creator  : new PDFString(getOption(\"creator\", \"Kendo UI PDF Generator\"), true),\n        CreationDate : getOption(\"date\", new Date())\n    }));\n\n    self.addPage = function(options) {\n        var paperOptions  = getPaperOptions(function(name, defval){\n            return (options && options[name] != null) ? options[name] : defval;\n        });\n        var paperSize = paperOptions.paperSize;\n        var margin    = paperOptions.margin;\n        var contentWidth  = paperSize[0];\n        var contentHeight = paperSize[1];\n        if (margin) {\n            contentWidth -= margin.left + margin.right;\n            contentHeight -= margin.top + margin.bottom;\n        }\n        var content = new PDFStream(makeOutput(), null, true);\n        var props = {\n            Contents : self.attach(content),\n            Parent   : pageTree,\n            MediaBox : [ 0, 0, paperSize[0], paperSize[1] ]\n        };\n        var page = new PDFPage(self, props);\n        page._content = content;\n        pageTree.addPage(self.attach(page));\n\n        // canvas-like coord. system.  (0,0) is upper-left.\n        // text must be vertically mirorred before drawing.\n        page.transform(1, 0, 0, -1, 0, paperSize[1]);\n\n        if (margin) {\n            page.translate(margin.left, margin.top);\n            // XXX: clip to right/bottom margin.  Make this optional?\n            page.rect(0, 0, contentWidth, contentHeight);\n            page.clip();\n        }\n\n        self.pages.push(page);\n        return page;\n    };\n\n    self.render = function() {\n        var i;\n        /// file header\n        out(\"%PDF-1.4\", NL, \"%\\xc2\\xc1\\xda\\xcf\\xce\", NL, NL);\n\n        /// file body\n        for (i = 0; i < objects.length; ++i) {\n            objects[i].renderFull(out);\n            out(NL, NL);\n        }\n\n        /// cross-reference table\n        var xrefOffset = out.offset();\n        out(\"xref\", NL, 0, \" \", objects.length + 1, NL);\n        out(\"0000000000 65535 f \", NL);\n        for (i = 0; i < objects.length; ++i) {\n            out(zeropad(objects[i]._offset, 10), \" 00000 n \", NL);\n        }\n        out(NL);\n\n        /// trailer\n        out(\"trailer\", NL);\n        out(new PDFDictionary({\n            Size: objects.length + 1,\n            Root: catalog,\n            Info: info\n        }), NL, NL);\n\n        /// end\n        out(\"startxref\", NL, xrefOffset, NL);\n        out(\"%%EOF\", NL);\n\n        return out.stream().offset(0);\n    };\n\n    self.loadFonts = loadFonts;\n    self.loadImages = loadImages;\n};\n\nPDFDocument.prototype.getFont = function getFont (url) {\n    var font = this.FONTS[url];\n    if (!font) {\n        font = FONT_CACHE[url];\n        if (!font) {\n            throw new Error(\"Font \" + url + \" has not been loaded\");\n        }\n        if (font === true) {\n            font = this.attach(new PDFStandardFont(url));\n        } else {\n            font = this.attach(new PDFFont(this, font));\n        }\n        this.FONTS[url] = font;\n    }\n    return font;\n};\n\nPDFDocument.prototype.getImage = function getImage (url) {\n    var img = this.IMAGES[url];\n    if (!img) {\n        img = IMAGE_CACHE[url];\n        if (!img) {\n            throw new Error(\"Image \" + url + \" has not been loaded\");\n        }\n        if (img === \"ERROR\") {\n            return null;\n        }\n        img = this.IMAGES[url] = this.attach(img.asStream(this));\n    }\n    return img;\n};\n\nPDFDocument.prototype.getOpacityGS = function getOpacityGS (opacity, forStroke) {\n    var id = parseFloat(opacity).toFixed(3);\n    opacity = parseFloat(id);\n    id += forStroke ? \"S\" : \"F\";\n    var cache = this._opacityGSCache || (this._opacityGSCache = {});\n    var gs = cache[id];\n    if (!gs) {\n        var props = {\n            Type: _(\"ExtGState\")\n        };\n        if (forStroke) {\n            props.CA = opacity;\n        } else {\n            props.ca = opacity;\n        }\n        gs = this.attach(new PDFDictionary(props));\n        gs._resourceName = _(\"GS\" + (++RESOURCE_COUNTER));\n        cache[id] = gs;\n    }\n    return gs;\n};\n\nPDFDocument.prototype.dict = function dict (props) {\n    return new PDFDictionary(props);\n};\n\nPDFDocument.prototype.name = function name (str) {\n    return _(str);\n};\n\nPDFDocument.prototype.stream = function stream (props, content) {\n    return new PDFStream(content, props);\n};\n\n/* -----[ utils ]----- */\n\nfunction pad(str, len, ch) {\n    while (str.length < len) {\n        str = ch + str;\n    }\n    return str;\n}\n\nfunction zeropad(n, len) {\n    return pad(String(n), len, \"0\");\n}\n\nfunction hasOwnProperty(obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nvar isArray = Array.isArray || function(obj) {\n    return obj instanceof Array;\n};\n\nfunction isDate(obj) {\n    return obj instanceof Date;\n}\n\nfunction renderArray(a, out) {\n    out(\"[\");\n    if (a.length > 0) {\n        out.withIndent(function(){\n            for (var i = 0; i < a.length; ++i) {\n                if (i > 0 && i % 8 === 0) {\n                    out.indent(a[i]);\n                } else {\n                    out(\" \", a[i]);\n                }\n            }\n        });\n        //out.indent();\n    }\n    out(\" ]\");\n}\n\nfunction renderDate(date, out) {\n    out(\"(D:\",\n        zeropad(date.getUTCFullYear(), 4),\n        zeropad(date.getUTCMonth() + 1, 2),\n        zeropad(date.getUTCDate(), 2),\n        zeropad(date.getUTCHours(), 2),\n        zeropad(date.getUTCMinutes(), 2),\n        zeropad(date.getUTCSeconds(), 2),\n        \"Z)\");\n}\n\nfunction mm2pt(mm) {\n    return mm * (72/25.4);\n}\n\nfunction cm2pt(cm) {\n    return mm2pt(cm * 10);\n}\n\nfunction in2pt(inch)  {\n    return inch * 72;\n}\n\n\nfunction unitsToPoints(x, def) {\n    if (typeof x == \"number\") {\n        return x;\n    }\n    if (typeof x == \"string\") {\n        var m;\n        m = /^\\s*([0-9.]+)\\s*(mm|cm|in|pt)\\s*$/.exec(x);\n        if (m) {\n            var num = parseFloat(m[1]);\n            if (!isNaN(num)) {\n                if (m[2] == \"pt\") {\n                    return num;\n                }\n                return {\n                    \"mm\": mm2pt,\n                    \"cm\": cm2pt,\n                    \"in\": in2pt\n                }[m[2]](num);\n            }\n        }\n    }\n    if (def != null) {\n        return def;\n    }\n    throw new Error(\"Can't parse unit: \" + x);\n}\n\n/* -----[ PDF basic objects ]----- */\n\nvar PDFValue = function PDFValue () {};\n\nPDFValue.prototype.beforeRender = function beforeRender () {};\n\nvar PDFString = (function (PDFValue) {\n    function PDFString(value, utf16be) {\n        PDFValue.call(this);\n        this.value = value;\n        this.utf16be = Boolean(utf16be);\n    }\n\n    if ( PDFValue ) PDFString.__proto__ = PDFValue;\n    PDFString.prototype = Object.create( PDFValue && PDFValue.prototype );\n    PDFString.prototype.constructor = PDFString;\n\n    PDFString.prototype.render = function render (out) {\n        var txt = this.value;\n        if (this.utf16be) {\n            txt = BOM + encodeUTF16BE(txt);\n            txt = txt.replace(/([\\(\\)\\\\])/g, \"\\\\$1\");\n            out(\"(\", txt, \")\");\n        } else {\n            // out.writeString truncates charcodes to 8 bits and\n            // 0x128 & 0xFF is 40, the code for open paren.\n            // therefore we need to do the chopping here to make\n            // sure we backslash all cases.\n            var data = [ 40 ]; // open PDF string '('\n            for (var i = 0; i < txt.length; ++i) {\n                var code = txt.charCodeAt(i) & 0xFF;\n                if (code == 40 || code == 41 || code == 92) {\n                    // backslash before (, ) and \\\n                    data.push(92);\n                }\n                data.push(code);\n            }\n            data.push(41);  // ')' close PDF string\n            out.writeData(data);\n        }\n    };\n\n    PDFString.prototype.toString = function toString () {\n        return this.value;\n    };\n\n    return PDFString;\n}(PDFValue));\n\nvar PDFHexString = (function (PDFString) {\n    function PDFHexString(value) {\n        PDFString.call(this, value);\n        this.value = value;\n    }\n\n    if ( PDFString ) PDFHexString.__proto__ = PDFString;\n    PDFHexString.prototype = Object.create( PDFString && PDFString.prototype );\n    PDFHexString.prototype.constructor = PDFHexString;\n\n    PDFHexString.prototype.render = function render (out) {\n        var this$1 = this;\n\n        out(\"<\");\n        for (var i = 0; i < this.value.length; ++i) {\n            out(zeropad(this$1.value.charCodeAt(i).toString(16), 4));\n        }\n        out(\">\");\n    };\n\n    return PDFHexString;\n}(PDFString));\n\n/// names\nvar PDFName = (function (PDFValue) {\n    function PDFName(name) {\n        PDFValue.call(this);\n        this.name = name;\n    }\n\n    if ( PDFValue ) PDFName.__proto__ = PDFValue;\n    PDFName.prototype = Object.create( PDFValue && PDFValue.prototype );\n    PDFName.prototype.constructor = PDFName;\n\n    PDFName.get = function get (name) {\n        return _(name);\n    };\n\n    PDFName.prototype.render = function render (out) {\n        out(\"/\" + this.escape());\n    };\n\n    PDFName.prototype.escape = function escape () {\n        return this.name.replace(/[^\\x21-\\x7E]/g, function(c){\n            return \"#\" + zeropad(c.charCodeAt(0).toString(16), 2);\n        });\n    };\n\n    PDFName.prototype.toString = function toString () {\n        return this.name;\n    };\n\n    return PDFName;\n}(PDFValue));\n\nvar PDFName_cache = {};\n\nfunction _(name) {\n    if (hasOwnProperty(PDFName_cache, name)) {\n        return PDFName_cache[name];\n    }\n    return (PDFName_cache[name] = new PDFName(name));\n}\n\n/// dictionary\n\nvar PDFDictionary = (function (PDFValue) {\n    function PDFDictionary(props) {\n        PDFValue.call(this);\n        this.props = props;\n    }\n\n    if ( PDFValue ) PDFDictionary.__proto__ = PDFValue;\n    PDFDictionary.prototype = Object.create( PDFValue && PDFValue.prototype );\n    PDFDictionary.prototype.constructor = PDFDictionary;\n\n    PDFDictionary.prototype.render = function render (out) {\n        var props = this.props, empty = true;\n        out(\"<<\");\n        out.withIndent(function(){\n            for (var i in props) {\n                if (hasOwnProperty(props, i) && !/^_/.test(i)) {\n                    empty = false;\n                    out.indent(_(i), \" \", props[i]);\n                }\n            }\n        });\n        if (!empty) {\n            out.indent();\n        }\n        out(\">>\");\n    };\n\n    return PDFDictionary;\n}(PDFValue));\n\n/// streams\n\nvar PDFStream = (function (PDFValue) {\n    function PDFStream(data, props, compress) {\n        PDFValue.call(this);\n        if (typeof data == \"string\") {\n            var tmp = BinaryStream();\n            tmp.write(data);\n            data = tmp;\n        }\n        this.data = data;\n        this.props = props || {};\n        this.compress = compress;\n    }\n\n    if ( PDFValue ) PDFStream.__proto__ = PDFValue;\n    PDFStream.prototype = Object.create( PDFValue && PDFValue.prototype );\n    PDFStream.prototype.constructor = PDFStream;\n\n    PDFStream.prototype.render = function render (out) {\n        var data = this.data.get(), props = this.props;\n        if (this.compress && supportsDeflate()) {\n            if (!props.Filter) {\n                props.Filter = [];\n            } else if (!(props.Filter instanceof Array)) {\n                props.Filter = [ props.Filter ];\n            }\n            props.Filter.unshift(_(\"FlateDecode\"));\n            data = deflate(data);\n        }\n        props.Length = data.length;\n        out(new PDFDictionary(props), \" stream\", NL);\n        out.writeData(data);\n        out(NL, \"endstream\");\n    };\n\n    return PDFStream;\n}(PDFValue));\n\n/// catalog\n\nvar PDFCatalog = (function (PDFDictionary) {\n    function PDFCatalog() {\n        PDFDictionary.call(this, {\n            Type: _(\"Catalog\")\n        });\n    }\n\n    if ( PDFDictionary ) PDFCatalog.__proto__ = PDFDictionary;\n    PDFCatalog.prototype = Object.create( PDFDictionary && PDFDictionary.prototype );\n    PDFCatalog.prototype.constructor = PDFCatalog;\n\n    PDFCatalog.prototype.setPages = function setPages (pagesObj) {\n        this.props.Pages = pagesObj;\n    };\n\n    return PDFCatalog;\n}(PDFDictionary));\n\n/// page tree\n\nvar PDFPageTree = (function (PDFDictionary) {\n    function PDFPageTree() {\n        PDFDictionary.call(this, {\n            Type  : _(\"Pages\"),\n            Kids  : [],\n            Count : 0\n        });\n    }\n\n    if ( PDFDictionary ) PDFPageTree.__proto__ = PDFDictionary;\n    PDFPageTree.prototype = Object.create( PDFDictionary && PDFDictionary.prototype );\n    PDFPageTree.prototype.constructor = PDFPageTree;\n\n    PDFPageTree.prototype.addPage = function addPage (pageObj) {\n        this.props.Kids.push(pageObj);\n        this.props.Count++;\n    };\n\n    return PDFPageTree;\n}(PDFDictionary));\n\n/// images\n\n// JPEG\n\nvar SOF_CODES = [0xc0, 0xc1, 0xc2, 0xc3, 0xc5, 0xc6, 0xc7, 0xc9, 0xca, 0xcb, 0xcd, 0xce, 0xcf];\n\nvar PDFJpegImage = function PDFJpegImage(data) {\n    // we must determine the correct color space.  we'll parse a bit\n    // of the JPEG stream for this, it's still better than going\n    // through the canvas.\n    // https://github.com/telerik/kendo-ui-core/issues/2845\n    data.offset(0);\n    var width, height, colorSpace, bitsPerComponent;\n    var soi = data.readShort();\n    if (soi != 0xFFD8) {\n        // XXX: do we have some better options here?\n        throw new Error(\"Invalid JPEG image\");\n    }\n    while (!data.eof()) {\n        var ff = data.readByte();\n        if (ff != 0xFF) {\n            throw new Error(\"Invalid JPEG image\");\n        }\n        var marker = data.readByte();\n        var length = data.readShort();\n        if (SOF_CODES.indexOf(marker) >= 0) {\n            // \"start of frame\" marker\n            bitsPerComponent = data.readByte();\n            height = data.readShort();\n            width = data.readShort();\n            colorSpace = data.readByte();\n            break;\n        }\n        data.skip(length - 2);\n    }\n\n    if (colorSpace == null) {\n        throw new Error(\"Invalid JPEG image\");\n    }\n\n    var props = {\n        Type         : _(\"XObject\"),\n        Subtype      : _(\"Image\"),\n        Width        : width,\n        Height       : height,\n        BitsPerComponent : bitsPerComponent,\n        Filter       : _(\"DCTDecode\")\n    };\n\n    switch (colorSpace) {\n    case 1:\n        props.ColorSpace = _(\"DeviceGray\");\n        break;\n    case 3:\n        props.ColorSpace = _(\"DeviceRGB\");\n        break;\n    case 4:\n        props.ColorSpace = _(\"DeviceCMYK\");\n        props.Decode = [ 1, 0, 1, 0, 1, 0, 1, 0 ]; // invert colors\n        break;\n    }\n\n    this.asStream = function() {\n        data.offset(0);\n        var stream = new PDFStream(data, props);\n        stream._resourceName = _(\"I\" + (++RESOURCE_COUNTER));\n        return stream;\n    };\n};\n\n// PDFRawImage will be used for images with transparency (PNG)\n\nvar PDFRawImage = function PDFRawImage(width, height, rgb, alpha) {\n    this.asStream = function(pdf) {\n        var mask = new PDFStream(alpha, {\n            Type         : _(\"XObject\"),\n            Subtype      : _(\"Image\"),\n            Width        : width,\n            Height       : height,\n            BitsPerComponent : 8,\n            ColorSpace   : _(\"DeviceGray\")\n        }, true);\n        var stream = new PDFStream(rgb, {\n            Type         : _(\"XObject\"),\n            Subtype      : _(\"Image\"),\n            Width        : width,\n            Height       : height,\n            BitsPerComponent : 8,\n            ColorSpace   : _(\"DeviceRGB\"),\n            SMask        : pdf.attach(mask)\n        }, true);\n        stream._resourceName = _(\"I\" + (++RESOURCE_COUNTER));\n        return stream;\n    };\n};\n\n/// standard fonts\n\nvar PDFStandardFont = (function (PDFDictionary) {\n    function PDFStandardFont(name){\n        PDFDictionary.call(this, {\n            Type     : _(\"Font\"),\n            Subtype  : _(\"Type1\"),\n            BaseFont : _(name)\n        });\n\n        this._resourceName = _(\"F\" + (++RESOURCE_COUNTER));\n    }\n\n    if ( PDFDictionary ) PDFStandardFont.__proto__ = PDFDictionary;\n    PDFStandardFont.prototype = Object.create( PDFDictionary && PDFDictionary.prototype );\n    PDFStandardFont.prototype.constructor = PDFStandardFont;\n\n    PDFStandardFont.prototype.encodeText = function encodeText (str) {\n        return new PDFString(String(str));\n    };\n\n    return PDFStandardFont;\n}(PDFDictionary));\n\n/// TTF fonts\n\nvar PDFFont = (function (PDFDictionary) {\n    function PDFFont(pdf, font, props){\n        PDFDictionary.call(this, {});\n\n        props = this.props;\n        props.Type = _(\"Font\");\n        props.Subtype = _(\"Type0\");\n        props.Encoding = _(\"Identity-H\");\n\n        this._pdf = pdf;\n        this._font = font;\n        this._sub = font.makeSubset();\n        this._resourceName = _(\"F\" + (++RESOURCE_COUNTER));\n\n        var head = font.head;\n\n        this.name = font.psName;\n        var scale = this.scale = font.scale;\n        this.bbox = [\n            head.xMin * scale,\n            head.yMin * scale,\n            head.xMax * scale,\n            head.yMax * scale\n        ];\n\n        this.italicAngle = font.post.italicAngle;\n        this.ascent = font.ascent * scale;\n        this.descent = font.descent * scale;\n        this.lineGap = font.lineGap * scale;\n        this.capHeight = font.os2.capHeight || this.ascent;\n        this.xHeight = font.os2.xHeight || 0;\n        this.stemV = 0;\n\n        this.familyClass = (font.os2.familyClass || 0) >> 8;\n        this.isSerif = this.familyClass >= 1 && this.familyClass <= 7;\n        this.isScript = this.familyClass == 10;\n\n        this.flags = ((font.post.isFixedPitch ? 1 : 0) |\n                    (this.isSerif ? 1 << 1 : 0) |\n                    (this.isScript ? 1 << 3 : 0) |\n                    (this.italicAngle !== 0 ? 1 << 6 : 0) |\n                    (1 << 5));\n        }\n\n    if ( PDFDictionary ) PDFFont.__proto__ = PDFDictionary;\n    PDFFont.prototype = Object.create( PDFDictionary && PDFDictionary.prototype );\n    PDFFont.prototype.constructor = PDFFont;\n\n        PDFFont.prototype.encodeText = function encodeText (text) {\n            return new PDFHexString(this._sub.encodeText(String(text)));\n        };\n\n        PDFFont.prototype.getTextWidth = function getTextWidth (fontSize, text) {\n            var this$1 = this;\n\n            var width = 0, codeMap = this._font.cmap.codeMap;\n            for (var i = 0; i < text.length; ++i) {\n                var glyphId = codeMap[text.charCodeAt(i)];\n                width += this$1._font.widthOfGlyph(glyphId || 0);\n            }\n            return width * fontSize / 1000;\n        };\n\n        PDFFont.prototype.beforeRender = function beforeRender () {\n            var self = this;\n            var sub = self._sub;\n\n            // write the TTF data\n            var data = sub.render();\n            var fontStream = new PDFStream(BinaryStream(data), {\n                Length1: data.length\n            }, true);\n\n            var descriptor = self._pdf.attach(new PDFDictionary({\n                Type         : _(\"FontDescriptor\"),\n                FontName     : _(self._sub.psName),\n                FontBBox     : self.bbox,\n                Flags        : self.flags,\n                StemV        : self.stemV,\n                ItalicAngle  : self.italicAngle,\n                Ascent       : self.ascent,\n                Descent      : self.descent,\n                CapHeight    : self.capHeight,\n                XHeight      : self.xHeight,\n                FontFile2    : self._pdf.attach(fontStream)\n            }));\n\n            var cmap = sub.ncid2ogid;\n            var firstChar = sub.firstChar;\n            var lastChar = sub.lastChar;\n            var charWidths = [];\n            (function loop(i, chunk){\n                if (i <= lastChar) {\n                    var gid = cmap[i];\n                    if (gid == null) {\n                        loop(i + 1);\n                    } else {\n                        if (!chunk) {\n                            charWidths.push(i, chunk = []);\n                        }\n                        chunk.push(self._font.widthOfGlyph(gid));\n                        loop(i + 1, chunk);\n                    }\n                }\n            })(firstChar);\n\n            // As if two dictionaries weren't enough, we need another\n            // one, the \"descendant font\".  Only that one can be of\n            // Subtype CIDFontType2.  PDF is the X11 of document\n            // formats: portable but full of legacy that nobody cares\n            // about anymore.\n\n            var descendant = new PDFDictionary({\n                Type: _(\"Font\"),\n                Subtype: _(\"CIDFontType2\"),\n                BaseFont: _(self._sub.psName),\n                CIDSystemInfo: new PDFDictionary({\n                    Registry   : new PDFString(\"Adobe\"),\n                    Ordering   : new PDFString(\"Identity\"),\n                    Supplement : 0\n                }),\n                FontDescriptor: descriptor,\n                FirstChar: firstChar,\n                LastChar: lastChar,\n                DW: Math.round(self._font.widthOfGlyph(0)),\n                W: charWidths,\n                CIDToGIDMap: self._pdf.attach(self._makeCidToGidMap())\n            });\n\n            var dict = self.props;\n            dict.BaseFont = _(self._sub.psName);\n            dict.DescendantFonts = [ self._pdf.attach(descendant) ];\n\n            // Compute the ToUnicode map so that apps can extract\n            // meaningful text from the PDF.\n            var unimap = new PDFToUnicodeCmap(firstChar, lastChar, sub.subset);\n            var unimapStream = new PDFStream(makeOutput(), null, true);\n            unimapStream.data(unimap);\n            dict.ToUnicode = self._pdf.attach(unimapStream);\n        };\n\n        PDFFont.prototype._makeCidToGidMap = function _makeCidToGidMap () {\n            return new PDFStream(BinaryStream(this._sub.cidToGidMap()), null, true);\n        };\n\n    return PDFFont;\n}(PDFDictionary));\n\nvar PDFToUnicodeCmap = (function (PDFValue) {\n    function PDFToUnicodeCmap(firstChar, lastChar, map){\n        PDFValue.call(this);\n        this.firstChar = firstChar;\n        this.lastChar = lastChar;\n        this.map = map;\n    }\n\n    if ( PDFValue ) PDFToUnicodeCmap.__proto__ = PDFValue;\n    PDFToUnicodeCmap.prototype = Object.create( PDFValue && PDFValue.prototype );\n    PDFToUnicodeCmap.prototype.constructor = PDFToUnicodeCmap;\n\n    PDFToUnicodeCmap.prototype.render = function render (out) {\n        out.indent(\"/CIDInit /ProcSet findresource begin\");\n        out.indent(\"12 dict begin\");\n        out.indent(\"begincmap\");\n        out.indent(\"/CIDSystemInfo <<\");\n        out.indent(\"  /Registry (Adobe)\");\n        out.indent(\"  /Ordering (UCS)\");\n        out.indent(\"  /Supplement 0\");\n        out.indent(\">> def\");\n        out.indent(\"/CMapName /Adobe-Identity-UCS def\");\n        out.indent(\"/CMapType 2 def\");\n        out.indent(\"1 begincodespacerange\");\n        out.indent(\"  <0000><ffff>\");\n        out.indent(\"endcodespacerange\");\n\n        var self = this;\n        out.indent(self.lastChar - self.firstChar + 1, \" beginbfchar\");\n        out.withIndent(function(){\n            for (var code = self.firstChar; code <= self.lastChar; ++code) {\n                var unicode = self.map[code];\n                var str = ucs2encode([ unicode ]);\n                out.indent(\"<\", zeropad(code.toString(16), 4), \">\", \"<\");\n                for (var i = 0; i < str.length; ++i) {\n                    out(zeropad(str.charCodeAt(i).toString(16), 4));\n                }\n                out(\">\");\n            }\n        });\n        out.indent(\"endbfchar\");\n\n        out.indent(\"endcmap\");\n        out.indent(\"CMapName currentdict /CMap defineresource pop\");\n        out.indent(\"end\");\n        out.indent(\"end\");\n    };\n\n    return PDFToUnicodeCmap;\n}(PDFValue));\n\n/// gradients\n\nfunction makeHash(a) {\n    return a.map(function(x){\n        return isArray(x) ? makeHash(x)\n            : typeof x == \"number\" ? (Math.round(x * 1000) / 1000).toFixed(3)\n            : x;\n    }).join(\" \");\n}\n\nfunction cacheColorGradientFunction(pdf, r1, g1, b1, r2, g2, b2) {\n    var hash = makeHash([ r1, g1, b1, r2, g2, b2 ]);\n    var func = pdf.GRAD_COL_FUNCTIONS[hash];\n    if (!func) {\n        func = pdf.GRAD_COL_FUNCTIONS[hash] = pdf.attach(new PDFDictionary({\n            FunctionType: 2,\n            Domain: [ 0, 1 ],\n            Range: [ 0, 1, 0, 1, 0, 1 ],\n            N: 1,\n            C0: [ r1 , g1 , b1 ],\n            C1: [ r2 , g2 , b2 ]\n        }));\n    }\n    return func;\n}\n\nfunction cacheOpacityGradientFunction(pdf, a1, a2) {\n    var hash = makeHash([ a1, a2 ]);\n    var func = pdf.GRAD_OPC_FUNCTIONS[hash];\n    if (!func) {\n        func = pdf.GRAD_OPC_FUNCTIONS[hash] = pdf.attach(new PDFDictionary({\n            FunctionType: 2,\n            Domain: [ 0, 1 ],\n            Range: [ 0, 1 ],\n            N: 1,\n            C0: [ a1 ],\n            C1: [ a2 ]\n        }));\n    }\n    return func;\n}\n\nfunction makeGradientFunctions(pdf, stops) {\n    var hasAlpha = false;\n    var opacities = [];\n    var colors = [];\n    var offsets = [];\n    var encode = [];\n    var i, prev, cur, prevColor, curColor;\n    for (i = 1; i < stops.length; ++i) {\n        prev = stops[i - 1];\n        cur = stops[i];\n        prevColor = prev.color;\n        curColor = cur.color;\n        colors.push(cacheColorGradientFunction(\n            pdf,\n            prevColor.r, prevColor.g, prevColor.b,\n            curColor.r,  curColor.g,  curColor.b\n        ));\n        if (prevColor.a < 1 || curColor.a < 1) {\n            hasAlpha = true;\n        }\n        offsets.push(cur.offset);\n        encode.push(0, 1);\n    }\n    if (hasAlpha) {\n        for (i = 1; i < stops.length; ++i) {\n            prev = stops[i - 1];\n            cur = stops[i];\n            prevColor = prev.color;\n            curColor = cur.color;\n            opacities.push(cacheOpacityGradientFunction(\n                pdf, prevColor.a, curColor.a\n            ));\n        }\n    }\n    offsets.pop();\n    return {\n        hasAlpha  : hasAlpha,\n        colors    : assemble(colors),\n        opacities : hasAlpha ? assemble(opacities) : null\n    };\n    function assemble(funcs) {\n        if (funcs.length == 1) {\n            return funcs[0];\n        }\n        return {\n            FunctionType: 3,\n            Functions: funcs,\n            Domain: [ 0, 1 ],\n            Bounds: offsets,\n            Encode: encode\n        };\n    }\n}\n\nfunction cacheColorGradient(pdf, isRadial, stops, coords, funcs, box) {\n    var shading, hash;\n    // if box is given then we have user-space coordinates, which\n    // means the gradient is designed for a certain position/size\n    // on page.  caching won't do any good.\n    if (!box) {\n        var a = [ isRadial ].concat(coords);\n        stops.forEach(function(x){\n            a.push(x.offset, x.color.r, x.color.g, x.color.b);\n        });\n        hash = makeHash(a);\n        shading = pdf.GRAD_COL[hash];\n    }\n    if (!shading) {\n        shading = new PDFDictionary({\n            Type: _(\"Shading\"),\n            ShadingType: isRadial ? 3 : 2,\n            ColorSpace: _(\"DeviceRGB\"),\n            Coords: coords,\n            Domain: [ 0, 1 ],\n            Function: funcs,\n            Extend: [ true, true ]\n        });\n        pdf.attach(shading);\n        shading._resourceName = \"S\" + (++RESOURCE_COUNTER);\n        if (hash) {\n            pdf.GRAD_COL[hash] = shading;\n        }\n    }\n    return shading;\n}\n\nfunction cacheOpacityGradient(pdf, isRadial, stops, coords, funcs, box) {\n    var opacity, hash;\n    // if box is given then we have user-space coordinates, which\n    // means the gradient is designed for a certain position/size\n    // on page.  caching won't do any good.\n    if (!box) {\n        var a = [ isRadial ].concat(coords);\n        stops.forEach(function(x){\n            a.push(x.offset, x.color.a);\n        });\n        hash = makeHash(a);\n        opacity = pdf.GRAD_OPC[hash];\n    }\n    if (!opacity) {\n        opacity = new PDFDictionary({\n            Type: _(\"ExtGState\"),\n            AIS: false,\n            CA: 1,\n            ca: 1,\n            SMask: {\n                Type: _(\"Mask\"),\n                S: _(\"Luminosity\"),\n                G: pdf.attach(new PDFStream(\"/a0 gs /s0 sh\", {\n                    Type: _(\"XObject\"),\n                    Subtype: _(\"Form\"),\n                    FormType: 1,\n                    BBox: (box ? [\n                        box.left, box.top + box.height, box.left + box.width, box.top\n                    ] : [ 0, 1, 1, 0 ]),\n                    Group: {\n                        Type: _(\"Group\"),\n                        S: _(\"Transparency\"),\n                        CS: _(\"DeviceGray\"),\n                        I: true\n                    },\n                    Resources: {\n                        ExtGState: {\n                            a0: { CA: 1, ca: 1 }\n                        },\n                        Shading: {\n                            s0: {\n                                ColorSpace: _(\"DeviceGray\"),\n                                Coords: coords,\n                                Domain: [ 0, 1 ],\n                                ShadingType: isRadial ? 3 : 2,\n                                Function: funcs,\n                                Extend: [ true, true ]\n                            }\n                        }\n                    }\n                }))\n            }\n        });\n        pdf.attach(opacity);\n        opacity._resourceName = \"O\" + (++RESOURCE_COUNTER);\n        if (hash) {\n            pdf.GRAD_OPC[hash] = opacity;\n        }\n    }\n    return opacity;\n}\n\nfunction cacheGradient(pdf, gradient, box) {\n    var isRadial = gradient.type == \"radial\";\n    var funcs = makeGradientFunctions(pdf, gradient.stops);\n    var coords = isRadial ? [\n        gradient.start.x , gradient.start.y , gradient.start.r,\n        gradient.end.x   , gradient.end.y   , gradient.end.r\n    ] : [\n        gradient.start.x , gradient.start.y,\n        gradient.end.x   , gradient.end.y\n    ];\n    var shading = cacheColorGradient(\n        pdf, isRadial, gradient.stops, coords, funcs.colors, gradient.userSpace && box\n    );\n    var opacity = funcs.hasAlpha ? cacheOpacityGradient(\n        pdf, isRadial, gradient.stops, coords, funcs.opacities, gradient.userSpace && box\n    ) : null;\n    return {\n        hasAlpha: funcs.hasAlpha,\n        shading: shading,\n        opacity: opacity\n    };\n}\n\n/// page object\n\nvar PDFPage = (function (PDFDictionary) {\n    function PDFPage(pdf, props){\n        PDFDictionary.call(this, props);\n\n        this._pdf = pdf;\n        this._rcount = 0;\n        this._textMode = false;\n        this._fontResources = {};\n        this._gsResources = {};\n        this._xResources = {};\n        this._patResources = {};\n        this._shResources = {};\n        this._opacity = 1;\n        this._matrix = [ 1, 0, 0, 1, 0, 0 ];\n        this._annotations = [];\n\n        this._font = null;\n        this._fontSize = null;\n\n        this._contextStack = [];\n\n        props = this.props;\n        props.Type = _(\"Page\");\n        props.ProcSet = [\n            _(\"PDF\"),\n            _(\"Text\"),\n            _(\"ImageB\"),\n            _(\"ImageC\"),\n            _(\"ImageI\")\n        ];\n        props.Resources = new PDFDictionary({\n            Font      : new PDFDictionary(this._fontResources),\n            ExtGState : new PDFDictionary(this._gsResources),\n            XObject   : new PDFDictionary(this._xResources),\n            Pattern   : new PDFDictionary(this._patResources),\n            Shading   : new PDFDictionary(this._shResources)\n        });\n        props.Annots = this._annotations;\n    }\n\n    if ( PDFDictionary ) PDFPage.__proto__ = PDFDictionary;\n    PDFPage.prototype = Object.create( PDFDictionary && PDFDictionary.prototype );\n    PDFPage.prototype.constructor = PDFPage;\n\n    PDFPage.prototype._out = function _out () {\n        this._content.data.apply(null, arguments);\n    };\n\n    PDFPage.prototype.transform = function transform (a, b, c, d, e, f) {\n        if (!isIdentityMatrix(arguments)) {\n            this._matrix = mmul(arguments, this._matrix);\n            this._out(a, \" \", b, \" \", c, \" \", d, \" \", e, \" \", f, \" cm\");\n            // XXX: debug\n            // this._out(\" % current matrix: \", this._matrix);\n            this._out(NL);\n        }\n    };\n\n    PDFPage.prototype.translate = function translate (dx, dy) {\n        this.transform(1, 0, 0, 1, dx, dy);\n    };\n\n    PDFPage.prototype.scale = function scale (sx, sy) {\n        this.transform(sx, 0, 0, sy, 0, 0);\n    };\n\n    PDFPage.prototype.rotate = function rotate (angle) {\n        var cos = Math.cos(angle), sin = Math.sin(angle);\n        this.transform(cos, sin, -sin, cos, 0, 0);\n    };\n\n    PDFPage.prototype.beginText = function beginText () {\n        this._textMode = true;\n        this._out(\"BT\", NL);\n    };\n\n    PDFPage.prototype.endText = function endText () {\n        this._textMode = false;\n        this._out(\"ET\", NL);\n    };\n\n    PDFPage.prototype._requireTextMode = function _requireTextMode () {\n        if (!this._textMode) {\n            throw new Error(\"Text mode required; call page.beginText() first\");\n        }\n    };\n\n    PDFPage.prototype._requireFont = function _requireFont () {\n        if (!this._font) {\n            throw new Error(\"No font selected; call page.setFont() first\");\n        }\n    };\n\n    PDFPage.prototype.setFont = function setFont (font, size) {\n        this._requireTextMode();\n        if (font == null) {\n            font = this._font;\n        } else if (!(font instanceof PDFFont)) {\n            font = this._pdf.getFont(font);\n        }\n        if (size == null) {\n            size = this._fontSize;\n        }\n        this._fontResources[font._resourceName] = font;\n        this._font = font;\n        this._fontSize = size;\n        this._out(font._resourceName, \" \", size, \" Tf\", NL);\n    };\n\n    PDFPage.prototype.setTextLeading = function setTextLeading (size) {\n        this._requireTextMode();\n        this._out(size, \" TL\", NL);\n    };\n\n    PDFPage.prototype.setTextRenderingMode = function setTextRenderingMode (mode) {\n        this._requireTextMode();\n        this._out(mode, \" Tr\", NL);\n    };\n\n    PDFPage.prototype.showText = function showText (text, requestedWidth) {\n        this._requireFont();\n        if (text.length > 1 && requestedWidth && this._font instanceof PDFFont) {\n            var outputWidth = this._font.getTextWidth(this._fontSize, text);\n            var scale = requestedWidth / outputWidth * 100;\n            this._out(scale, \" Tz \");\n        }\n        this._out(this._font.encodeText(text), \" Tj\", NL);\n    };\n\n    PDFPage.prototype.showTextNL = function showTextNL (text) {\n        this._requireFont();\n        this._out(this._font.encodeText(text), \" '\", NL);\n    };\n\n    PDFPage.prototype.addLink = function addLink (uri, box) {\n        var ll = this._toPage({ x: box.left, y: box.bottom });\n        var ur = this._toPage({ x: box.right, y: box.top });\n        this._annotations.push(new PDFDictionary({\n            Type    : _(\"Annot\"),\n            Subtype : _(\"Link\"),\n            Rect    : [ ll.x, ll.y, ur.x, ur.y ],\n            Border  : [ 0, 0, 0 ],\n            A       : new PDFDictionary({\n                Type : _(\"Action\"),\n                S    : _(\"URI\"),\n                URI  : new PDFString(uri)\n            })\n        }));\n    };\n\n    PDFPage.prototype.setStrokeColor = function setStrokeColor (r, g, b) {\n        this._out(r, \" \", g, \" \", b, \" RG\", NL);\n    };\n\n    PDFPage.prototype.setOpacity = function setOpacity (opacity) {\n        this.setFillOpacity(opacity);\n        this.setStrokeOpacity(opacity);\n        this._opacity *= opacity;\n    };\n\n    PDFPage.prototype.setStrokeOpacity = function setStrokeOpacity (opacity) {\n        if (opacity < 1) {\n            var gs = this._pdf.getOpacityGS(this._opacity * opacity, true);\n            this._gsResources[gs._resourceName] = gs;\n            this._out(gs._resourceName, \" gs\", NL);\n        }\n    };\n\n    PDFPage.prototype.setFillColor = function setFillColor (r, g, b) {\n        this._out(r, \" \", g, \" \", b, \" rg\", NL);\n    };\n\n    PDFPage.prototype.setFillOpacity = function setFillOpacity (opacity) {\n        if (opacity < 1) {\n            var gs = this._pdf.getOpacityGS(this._opacity * opacity, false);\n            this._gsResources[gs._resourceName] = gs;\n            this._out(gs._resourceName, \" gs\", NL);\n        }\n    };\n\n    PDFPage.prototype.gradient = function gradient (gradient$1, box) {\n        this.save();\n        this.rect(box.left, box.top, box.width, box.height);\n        this.clip();\n        if (!gradient$1.userSpace) {\n            this.transform(box.width, 0, 0, box.height, box.left, box.top);\n        }\n        var g = cacheGradient(this._pdf, gradient$1, box);\n        var sname = g.shading._resourceName, oname;\n        this._shResources[sname] = g.shading;\n        if (g.hasAlpha) {\n            oname = g.opacity._resourceName;\n            this._gsResources[oname] = g.opacity;\n            this._out(\"/\" + oname + \" gs \");\n        }\n        this._out(\"/\" + sname + \" sh\", NL);\n        this.restore();\n    };\n\n    PDFPage.prototype.setDashPattern = function setDashPattern (dashArray, dashPhase) {\n        this._out(dashArray, \" \", dashPhase, \" d\", NL);\n    };\n\n    PDFPage.prototype.setLineWidth = function setLineWidth (width) {\n        this._out(width, \" w\", NL);\n    };\n\n    PDFPage.prototype.setLineCap = function setLineCap (lineCap) {\n        this._out(lineCap, \" J\", NL);\n    };\n\n    PDFPage.prototype.setLineJoin = function setLineJoin (lineJoin) {\n        this._out(lineJoin, \" j\", NL);\n    };\n\n    PDFPage.prototype.setMitterLimit = function setMitterLimit (mitterLimit) {\n        this._out(mitterLimit, \" M\", NL);\n    };\n\n    PDFPage.prototype.save = function save () {\n        this._contextStack.push(this._context());\n        this._out(\"q\", NL);\n    };\n\n    PDFPage.prototype.restore = function restore () {\n        this._out(\"Q\", NL);\n        this._context(this._contextStack.pop());\n    };\n\n\n    // paths\n    PDFPage.prototype.moveTo = function moveTo (x, y) {\n        this._out(x, \" \", y, \" m\", NL);\n    };\n\n    PDFPage.prototype.lineTo = function lineTo (x, y) {\n        this._out(x, \" \", y, \" l\", NL);\n    };\n\n    PDFPage.prototype.bezier = function bezier (x1, y1, x2, y2, x3, y3) {\n        this._out(x1, \" \", y1, \" \", x2, \" \", y2, \" \", x3, \" \", y3, \" c\", NL);\n    };\n\n    PDFPage.prototype.bezier1 = function bezier1 (x1, y1, x3, y3) {\n        this._out(x1, \" \", y1, \" \", x3, \" \", y3, \" y\", NL);\n    };\n\n    PDFPage.prototype.bezier2 = function bezier2 (x2, y2, x3, y3) {\n        this._out(x2, \" \", y2, \" \", x3, \" \", y3, \" v\", NL);\n    };\n\n    PDFPage.prototype.close = function close () {\n        this._out(\"h\", NL);\n    };\n\n    PDFPage.prototype.rect = function rect (x, y, w, h) {\n        this._out(x, \" \", y, \" \", w, \" \", h, \" re\", NL);\n    };\n\n    PDFPage.prototype.ellipse = function ellipse (x, y, rx, ry) {\n        function _X(v) { return x + v; }\n        function _Y(v) { return y + v; }\n\n        // how to get to the \"magic number\" is explained here:\n        // http://www.whizkidtech.redprince.net/bezier/circle/kappa/\n        var k = 0.5522847498307936;\n\n        this.moveTo(_X(0), _Y(ry));\n        this.bezier(\n            _X(rx * k) , _Y(ry),\n            _X(rx)     , _Y(ry * k),\n            _X(rx)     , _Y(0)\n        );\n        this.bezier(\n            _X(rx)     , _Y(-ry * k),\n            _X(rx * k) , _Y(-ry),\n            _X(0)      , _Y(-ry)\n        );\n        this.bezier(\n            _X(-rx * k) , _Y(-ry),\n            _X(-rx)     , _Y(-ry * k),\n            _X(-rx)     , _Y(0)\n        );\n        this.bezier(\n            _X(-rx)     , _Y(ry * k),\n            _X(-rx * k) , _Y(ry),\n            _X(0)       , _Y(ry)\n        );\n    };\n\n    PDFPage.prototype.circle = function circle (x, y, r) {\n        this.ellipse(x, y, r, r);\n    };\n\n    PDFPage.prototype.stroke = function stroke () {\n        this._out(\"S\", NL);\n    };\n\n    PDFPage.prototype.nop = function nop () {\n        this._out(\"n\", NL);\n    };\n\n    PDFPage.prototype.clip = function clip () {\n        this._out(\"W n\", NL);\n    };\n\n    PDFPage.prototype.clipStroke = function clipStroke () {\n        this._out(\"W S\", NL);\n    };\n\n    PDFPage.prototype.closeStroke = function closeStroke () {\n        this._out(\"s\", NL);\n    };\n\n    PDFPage.prototype.fill = function fill () {\n        this._out(\"f\", NL);\n    };\n\n    PDFPage.prototype.fillStroke = function fillStroke () {\n        this._out(\"B\", NL);\n    };\n\n    PDFPage.prototype.drawImage = function drawImage (url) {\n        var img = this._pdf.getImage(url);\n        if (img) { // the result can be null for a cross-domain image\n            this._xResources[img._resourceName] = img;\n            this._out(img._resourceName, \" Do\", NL);\n        }\n    };\n\n    PDFPage.prototype.comment = function comment (txt) {\n        var self = this;\n        txt.split(/\\r?\\n/g).forEach(function(line){\n            self._out(\"% \", line, NL);\n        });\n    };\n\n    // internal\n    PDFPage.prototype._context = function _context (val) {\n        if (val != null) {\n            this._opacity = val.opacity;\n            this._matrix = val.matrix;\n        } else {\n            return {\n                opacity: this._opacity,\n                matrix: this._matrix\n            };\n        }\n    };\n\n    PDFPage.prototype._toPage = function _toPage (p) {\n        var m = this._matrix;\n        var a = m[0], b = m[1], c = m[2], d = m[3], e = m[4], f = m[5];\n        return {\n            x: a*p.x + c*p.y + e,\n            y: b*p.x + d*p.y + f\n        };\n    };\n\n    return PDFPage;\n}(PDFDictionary));\n\nfunction unquote(str) {\n    return str.replace(/^\\s*(['\"])(.*)\\1\\s*$/, \"$2\");\n}\n\nfunction parseFontDef(fontdef) {\n    // XXX: this is very crude for now and buggy.  Proper parsing is quite involved.\n    var rx = /^\\s*((normal|italic)\\s+)?((normal|small-caps)\\s+)?((normal|bold|\\d+)\\s+)?(([0-9.]+)(px|pt))(\\/(([0-9.]+)(px|pt)|normal))?\\s+(.*?)\\s*$/i;\n    var m = rx.exec(fontdef);\n    if (!m) {\n        return { fontSize: 12, fontFamily: \"sans-serif\" };\n    }\n    var fontSize = m[8] ? parseInt(m[8], 10) : 12;\n    return {\n        italic     : m[2] && m[2].toLowerCase() == \"italic\",\n        variant    : m[4],\n        bold       : m[6] && /bold|700/i.test(m[6]),\n        fontSize   : fontSize,\n        lineHeight : m[12] ? m[12] == \"normal\" ? fontSize : parseInt(m[12], 10) : null,\n        fontFamily : m[14].split(/\\s*,\\s*/g).map(unquote)\n    };\n}\n\nfunction getFontURL(style) {\n    function mkFamily(name) {\n        if (style.bold) {\n            name += \"|bold\";\n        }\n        if (style.italic) {\n            name += \"|italic\";\n        }\n        return name.toLowerCase();\n    }\n    var fontFamily = style.fontFamily;\n    var name, url;\n    if (fontFamily instanceof Array) {\n        for (var i = 0; i < fontFamily.length; ++i) {\n            name = mkFamily(fontFamily[i]);\n            url = FONT_MAPPINGS[name];\n            if (url) {\n                break;\n            }\n        }\n    } else {\n        url = FONT_MAPPINGS[fontFamily.toLowerCase()];\n    }\n    while (typeof url == \"function\") {\n        url = url();\n    }\n    if (!url) {\n        url = \"Times-Roman\";\n    }\n    return url;\n}\n\nvar FONT_MAPPINGS = {\n    \"serif\"                    : \"Times-Roman\",\n    \"serif|bold\"               : \"Times-Bold\",\n    \"serif|italic\"             : \"Times-Italic\",\n    \"serif|bold|italic\"        : \"Times-BoldItalic\",\n    \"sans-serif\"               : \"Helvetica\",\n    \"sans-serif|bold\"          : \"Helvetica-Bold\",\n    \"sans-serif|italic\"        : \"Helvetica-Oblique\",\n    \"sans-serif|bold|italic\"   : \"Helvetica-BoldOblique\",\n    \"monospace\"                : \"Courier\",\n    \"monospace|bold\"           : \"Courier-Bold\",\n    \"monospace|italic\"         : \"Courier-Oblique\",\n    \"monospace|bold|italic\"    : \"Courier-BoldOblique\",\n    \"zapfdingbats\"             : \"ZapfDingbats\",\n    \"zapfdingbats|bold\"        : \"ZapfDingbats\",\n    \"zapfdingbats|italic\"      : \"ZapfDingbats\",\n    \"zapfdingbats|bold|italic\" : \"ZapfDingbats\"\n};\n\nfunction fontAlias(alias, name) {\n    alias = alias.toLowerCase();\n    FONT_MAPPINGS[alias] = function() {\n        return FONT_MAPPINGS[name];\n    };\n    FONT_MAPPINGS[alias + \"|bold\"] = function() {\n        return FONT_MAPPINGS[name + \"|bold\"];\n    };\n    FONT_MAPPINGS[alias + \"|italic\"] = function() {\n        return FONT_MAPPINGS[name + \"|italic\"];\n    };\n    FONT_MAPPINGS[alias + \"|bold|italic\"] = function() {\n        return FONT_MAPPINGS[name + \"|bold|italic\"];\n    };\n}\n\n// Let's define some common names to an appropriate replacement.\n// These are overridable via pdf.defineFont, should the user want to\n// include the proper versions.\n\nfontAlias(\"Times New Roman\" , \"serif\");\nfontAlias(\"Courier New\"     , \"monospace\");\nfontAlias(\"Arial\"           , \"sans-serif\");\nfontAlias(\"Helvetica\"       , \"sans-serif\");\nfontAlias(\"Verdana\"         , \"sans-serif\");\nfontAlias(\"Tahoma\"          , \"sans-serif\");\nfontAlias(\"Georgia\"         , \"sans-serif\");\nfontAlias(\"Monaco\"          , \"monospace\");\nfontAlias(\"Andale Mono\"     , \"monospace\");\n\nfunction defineFont(name, url) {\n    if (arguments.length == 1) {\n        for (var i in name) {\n            if (hasOwnProperty(name, i)) {\n                defineFont(i, name[i]);\n            }\n        }\n    } else {\n        name = name.toLowerCase();\n        FONT_MAPPINGS[name] = url;\n\n        // special handling for DejaVu fonts: if they get defined,\n        // let them also replace the default families, for good\n        // Unicode support out of the box.\n        switch (name) {\n          case \"dejavu sans\"               : FONT_MAPPINGS[\"sans-serif\"]              = url; break;\n          case \"dejavu sans|bold\"          : FONT_MAPPINGS[\"sans-serif|bold\"]         = url; break;\n          case \"dejavu sans|italic\"        : FONT_MAPPINGS[\"sans-serif|italic\"]       = url; break;\n          case \"dejavu sans|bold|italic\"   : FONT_MAPPINGS[\"sans-serif|bold|italic\"]  = url; break;\n          case \"dejavu serif\"              : FONT_MAPPINGS[\"serif\"]                   = url; break;\n          case \"dejavu serif|bold\"         : FONT_MAPPINGS[\"serif|bold\"]              = url; break;\n          case \"dejavu serif|italic\"       : FONT_MAPPINGS[\"serif|italic\"]            = url; break;\n          case \"dejavu serif|bold|italic\"  : FONT_MAPPINGS[\"serif|bold|italic\"]       = url; break;\n          case \"dejavu mono\"               : FONT_MAPPINGS[\"monospace\"]               = url; break;\n          case \"dejavu mono|bold\"          : FONT_MAPPINGS[\"monospace|bold\"]          = url; break;\n          case \"dejavu mono|italic\"        : FONT_MAPPINGS[\"monospace|italic\"]        = url; break;\n          case \"dejavu mono|bold|italic\"   : FONT_MAPPINGS[\"monospace|bold|italic\"]   = url; break;\n        }\n    }\n}\n\nfunction mmul(a, b) {\n    var a1 = a[0], b1 = a[1], c1 = a[2], d1 = a[3], e1 = a[4], f1 = a[5];\n    var a2 = b[0], b2 = b[1], c2 = b[2], d2 = b[3], e2 = b[4], f2 = b[5];\n    return [\n        a1*a2 + b1*c2,          a1*b2 + b1*d2,\n        c1*a2 + d1*c2,          c1*b2 + d1*d2,\n        e1*a2 + f1*c2 + e2,     e1*b2 + f1*d2 + f2\n    ];\n}\n\nfunction isIdentityMatrix(m) {\n    return m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0;\n}\n\nvar TEXT_RENDERING_MODE = {\n    fill           : 0,\n    stroke         : 1,\n    fillAndStroke  : 2,\n    invisible      : 3,\n    fillAndClip    : 4,\n    strokeAndClip  : 5,\n    fillStrokeClip : 6,\n    clip           : 7\n};\n\nexport {\n    PDFDocument as Document,\n    BinaryStream,\n    defineFont,\n    parseFontDef,\n    getFontURL,\n    loadFonts,\n    loadImages,\n    getPaperOptions,\n    clearImageCache,\n    TEXT_RENDERING_MODE\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}